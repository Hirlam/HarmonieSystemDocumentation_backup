<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Atmospheric Motion Vectors (AMV) · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox" checked/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../GNSS/">GNSS ZTD observations</a></li><li class="is-active"><a class="tocitem" href>Atmospheric Motion Vectors (AMV)</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li><li><a class="tocitem" href="#AMV-data-1"><span>AMV data</span></a></li><li><a class="tocitem" href="#HARMONIE-changes-1"><span>HARMONIE changes</span></a></li><li><a class="tocitem" href="#Source-code-1"><span>Source code</span></a></li><li><a class="tocitem" href="#Blacklist-1"><span>Blacklist</span></a></li></ul></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ECFlow tasks</a></li><li><a class="is-disabled">Observations</a></li><li class="is-active"><a href>Atmospheric Motion Vectors (AMV)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Atmospheric Motion Vectors (AMV)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/ObservationHowto/Amv?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Atmospheric-Motion-Vectors-(AMV)-1"><a class="docs-heading-anchor" href="#Atmospheric-Motion-Vectors-(AMV)-1">Atmospheric Motion Vectors (AMV)</a><a class="docs-heading-anchor-permalink" href="#Atmospheric-Motion-Vectors-(AMV)-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this short information about the (pre-)processing, assimilation, and post-processing, as well as access to the AMV data in the Harmonie system is shown.</p><h2 id="AMV-data-1"><a class="docs-heading-anchor" href="#AMV-data-1">AMV data</a><a class="docs-heading-anchor-permalink" href="#AMV-data-1" title="Permalink"></a></h2><p>AMV data is available via EUMETCast (the <a href="http://www.eumetsat.int/website/wcm/idc/idcplg?IdcService=GET_FILE&amp;dDocName=PDF_AMV_PG&amp;RevisionSelectionMethod=LatestReleased&amp;Rendition=Web">EUMETAT processed</a>), the MARS archive at ECMWF (both polar and geowind) or <a href="http://www.nwcsaf.org/Downloads/GEO/2018.1/Documents/Scientific_Docs/NWC-CDOP3-GEO-AEMET-SCI-UM-Wind_v1.1.pdf">locally</a> using NWCSAF software. Through the EUMETCast, both data are in BUFR format. An abstract from the 5th Winds Workshop on the quality control of EUMETSAT wind products (<a href="https://hirlam.org/trac/raw-attachment/wiki/HarmonieSystemDocumentation/ObservationHowto/Amv/S2-3_Elliott-Parallel.pdf">S2-3_Elliott-Parallel.pdf</a>) provides some useful information on how AMV BUFR is encoded. We define two kinds of AMV data in the Harmonie system: Geostationary satellite based (GEOW) and polar satellite based (POLW). GEOW and POLW can be processed separately through the usual request in scr/include.ass as described below.</p><h2 id="HARMONIE-changes-1"><a class="docs-heading-anchor" href="#HARMONIE-changes-1">HARMONIE changes</a><a class="docs-heading-anchor-permalink" href="#HARMONIE-changes-1" title="Permalink"></a></h2><h3 id="scr/include.ass-1"><a class="docs-heading-anchor" href="#scr/include.ass-1">scr/include.ass</a><a class="docs-heading-anchor-permalink" href="#scr/include.ass-1" title="Permalink"></a></h3><p>In [source:scr/include.ass] should be edited to &quot;switch on&quot; the use of AMVs (SATOB/geowinds):</p><pre><code class="language-bash">export GEOW_OBS=1               # Satob geowind / SAFNWC geowind
export GEOW_SOURCE=ears         # mars:MARS | else: file in $OBDIR
[[  $GEOW_OBS -eq 1  ]] &amp;&amp; types_BASE=&quot;$types_BASE geow&quot;

export POLW_OBS=1               # Polar winds
export POLW_SOURCE=ears         # mars:MARS | else: file in $OBDIR
[[  $POLW_OBS -eq 1  ]] &amp;&amp; types_BASE=&quot;$types_BASE polarw&quot;</code></pre><p><strong>Important:</strong> Please note that data from MARS were not yet tested!!! Roger is happy to assist if you prefer to use this option. The Harmonie system is updated with the aim to be able to use these data in operational application.</p><h3 id="param.cfg-1"><a class="docs-heading-anchor" href="#param.cfg-1">param.cfg</a><a class="docs-heading-anchor-permalink" href="#param.cfg-1" title="Permalink"></a></h3><p>The BUFR template used by your AMV data should be defined in the param.cfg file used by Bator. param.cfg files for Bator are in the const/bator_param directory. The geowind param.cfg template should be something like this:</p><pre><code class="language-bash">BEGIN geowind
A 0 4 18
codage       1  aaaaaa
  :          :    :
codage       A  aaaaaa
offset       1      24  offset for QI_3 (eumetsat &amp; tokyo)
offset       2      28  offset for QI_1 (NOAA)
offset       3      14  offset for QI_2 (NOAA)
offset       4      48  offset for QI_2 (eumetsat &amp; tokyo)
values       1  001007  SATELLITE IDENTIFIER
values       2  001031  IDENTIFICATION OF ORIGINATING/GENERATING CENTRE (SEE NOTE 10)
values       4  002221  SEGMENT SIZE AT NADIR IN X DIRECTION
values       5  002222  SEGMENT SIZE AT NADIR IN Y DIRECTION
values       6  004001  YEAR
values      12  005001  LATITUDE (HIGH ACCURACY)
values      13  006001  LONGITUDE (HIGH ACCURACY)
values      14  002252  SATELLITE INSTRUMENT DATA USED IN PROCESSING
values      15  002023  SATELLITE DERIVED WIND COMPUTATION METHOD
values      16  007004  PRESSURE
values      17  011001  WIND DIRECTION
values      18  011002  WIND SPEED
values      21  012193  COLDEST CLUSTER TEMPERATURE
values      22  002231  HEIGHT ASSIGNMENT METHOD
values      23  002232  TRACER CORRELATION METHOD
values      24  008012  LAND/SEA QUALIFIER
values      25  007024  SATELLITE ZENITH ANGLE
values     211  033007  % CONFIDENCE
END geowind</code></pre><p>Please be reminded that the processing of data from MARS was not yet tested. From 43h2.1, we have the all necessary content of the param file for processing of both GEOW and POLW in const/bator<em>param/param</em>bator.cfg.geow.{GEOW_SOURCE / POLW_SOURCE}</p><h3 id="BATOR-namelist-1"><a class="docs-heading-anchor" href="#BATOR-namelist-1">BATOR namelist</a><a class="docs-heading-anchor-permalink" href="#BATOR-namelist-1" title="Permalink"></a></h3><p>Depending on the satellite and channel you may have to add entries to the NADIRS namelist in the Bator script like the following:</p><pre><code class="language-bash">   TS_GEOWIND(isatid)%T_SELECT%LCANAL(ichanal)=.TRUE.,</code></pre><ul><li>Satellite identifiers are available here: [https://software.ecmwf.int/wiki/display/ECC/WMO%3D27+code-flag+table]</li><li>Bator defaults for MSG AMV data are set in <a href="https://hirlam.org/trac/browser/Harmonie/src/odb/pandor/module/bator_init_mod.F90#L648">src/odb/pandor/module/bator<em>init</em>mod.F90</a></li></ul><h2 id="Source-code-1"><a class="docs-heading-anchor" href="#Source-code-1">Source code</a><a class="docs-heading-anchor-permalink" href="#Source-code-1" title="Permalink"></a></h2><p>The reading of BUFR AMVs is taken care of by the [subroutine in <a href="https://hirlam.org/trac/browser/geowind]">source:Harmonie/src/odb/pandor/module/bator<em>decodbufr</em>mod.F90 src/odb/pandor/module/bator<em>decodbufr</em>mod.F90</a>. This subroutine reads the following parameters defined in the param.cfg file:</p><table><tr><th style="text-align: right">= Name            =</th><th style="text-align: right">= Description =</th></tr><tr><td style="text-align: right">Date and time</td><td style="text-align: right">derived from the tconfig(004001) - assumes month, day, hour and minute are in consecutive entries in the values array</td></tr><tr><td style="text-align: right">Location</td><td style="text-align: right">latitude and longitude are read from tconfig(005001) and tconfig(006001)</td></tr><tr><td style="text-align: right">Satellite</td><td style="text-align: right">the satellite identifier is read from tconfig(001007)</td></tr><tr><td style="text-align: right">Origin. center</td><td style="text-align: right">the originating center (of the AMV) is read from tconfig(001031)</td></tr><tr><td style="text-align: right">Compu. method</td><td style="text-align: right">the wind computation method (type of channel + cloudy/clear if WV) is read from tconfig(002023)</td></tr><tr><td style="text-align: right">Derivation method</td><td style="text-align: right">the height assignment method is read from tconfig(002163) and the tracking method from tconfig (002164)</td></tr><tr><td style="text-align: right">Channel frequency</td><td style="text-align: right">the centre frequency of the satellite channel is read from tconfig(002153)</td></tr><tr><td style="text-align: right">Height (pressure)</td><td style="text-align: right">the height of the AMV observation is read from tconfig(007004)</td></tr><tr><td style="text-align: right">Wind</td><td style="text-align: right">the wind speed and direction  are read from tconfig(011002) and tconfig(011001)</td></tr><tr><td style="text-align: right">Temperature</td><td style="text-align: right">the coldest cluster temperature is read from tconfig(012071)</td></tr><tr><td style="text-align: right">FG QI</td><td style="text-align: right">The QI (including FG consistency) for MSG AMVs is read from the first location where descriptor 033007 appears</td></tr><tr><td style="text-align: right">noFG-QI</td><td style="text-align: right">The FG-independent QI for MSG AMVs is read from the first location where 033007 appears + offset(1)=24</td></tr><tr><td style="text-align: right">Sat zenith angle</td><td style="text-align: right">the satellite zenith angle is read from tconfig(007024)</td></tr><tr><td style="text-align: right">Land/sea/coast</td><td style="text-align: right">a land/sea/coast qualifier is read from tconfig(008012)</td></tr></table><p>The geowind routine was adapted to handle MSG AMVs from MARS and its module <a href="https://hirlam.org/trac/browser/Harmonie/src/odb/pandor/module/bator_decodbufr_mod.F90">src/odb/pandor/module/bator<em>decodbufr</em>mod.F90</a> uploaded to the trunk (Mar 2017) .</p><h2 id="Blacklist-1"><a class="docs-heading-anchor" href="#Blacklist-1">Blacklist</a><a class="docs-heading-anchor-permalink" href="#Blacklist-1" title="Permalink"></a></h2><p>The selection/blacklist of AMVs according to channel, underlying sea/land, QI, etc. is done in <a href="https://hirlam.org/trac/browser/Harmonie/src/blacklist/mf_blacklist.b">src/blacklist/mf_blacklist.b</a>, section <em>- SATOB CONSTANT DATA SELECTION -</em>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../GNSS/">« GNSS ZTD observations</a><a class="docs-footer-nextpage" href="../../RadarData/">Assimilation of Radar Data »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 30 March 2021 17:28">Tuesday 30 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
