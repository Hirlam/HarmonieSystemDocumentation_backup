<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Makeup · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../Installation/">Installation</a></li><li><a class="tocitem" href="../General/">General Software Requirements</a></li><li class="is-active"><a class="tocitem" href>Makeup</a><ul class="internal"><li><a class="tocitem" href="#Background-1"><span>Background</span></a></li><li><a class="tocitem" href="#MAKEUP-very-quickly-1"><span>MAKEUP very quickly</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)-1"><span>Using MAKEUP to build auxlibs (bufr, gribex, rgb)</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-also-util/gl-tools-1"><span>Using MAKEUP to build also util/gl -tools</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools-1"><span>Using MAKEUP to build also Oulan and/or Monitor -tools</span></a></li><li><a class="tocitem" href="#Building-objects-away-from-HARMONIE_SRC-directory-1"><span>Building objects away from <code>$HARMONIE_SRC</code>-directory</span></a></li><li><a class="tocitem" href="#More-details-1"><span>More details</span></a></li><li><a class="tocitem" href="#How-is-ODB-related-stuff-handled-?-1"><span>How is ODB related stuff handled ?</span></a></li><li><a class="tocitem" href="#Miscellaneous-stuff-1"><span>Miscellaneous stuff</span></a></li><li><a class="tocitem" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../HarmonieSystemDocumentation.md)-1"><span>Back to the main page of the HARMONIE System Documentation</span></a></li></ul></li><li><a class="tocitem" href="../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../Content/">Directories</a></li><li><a class="tocitem" href="../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../Namelists/">Namelist</a></li><li><a class="tocitem" href="../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../Screening/">Screening</a></li><li><a class="tocitem" href="../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Installation</a></li><li class="is-active"><a href>Makeup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Makeup</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/Build_with_makeup?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Building-with-MAKEUP-1"><a class="docs-heading-anchor" href="#Building-with-MAKEUP-1">Building with MAKEUP</a><a class="docs-heading-anchor-permalink" href="#Building-with-MAKEUP-1" title="Permalink"></a></h1><h2 id="Background-1"><a class="docs-heading-anchor" href="#Background-1">Background</a><a class="docs-heading-anchor-permalink" href="#Background-1" title="Permalink"></a></h2><p>Makeup is an alternative mechanism to build the HARMONIE system Instead of using GMKPACK to build the libraries and binaries, standard GNU make (gmake) procedures are used, making build of executables an easier task. Also parallel make comes for free, thus enhanced turn-around time for build process. Furthermore, rebuilds and change of compiler flags – either per project and/or per source files basis – are now trivial to do.</p><h2 id="MAKEUP-very-quickly-1"><a class="docs-heading-anchor" href="#MAKEUP-very-quickly-1">MAKEUP very quickly</a><a class="docs-heading-anchor-permalink" href="#MAKEUP-very-quickly-1" title="Permalink"></a></h2><p>The process of using the MAKEUP system in stand-alone fashion is described next.</p><p>Lets define two helper variables for the presentation purposes:</p><p>The variable <strong>HARMONIE_SRC</strong> refers to the directory, where the AROME source code is situated. Another variable <strong>HARMONIE_MAKEUP</strong> refers to the directory, where build configuration files and MAKEUP&#39;s scripts are located. </p><pre><code class="language-bash">#!sh
# In ksh/bash
export HARMONIE_SRC=/some/path/harmonie/src
export HARMONIE_MAKEUP=/some/path/harmonie/util/makeup
# In csh/tcsh
setenv HARMONIE_SRC /some/path/harmonie/src
setenv HARMONIE_MAKEUP /some/path/harmonie/util/makeup</code></pre><p>Usually <strong>HARMONIE_MAKEUP</strong> is <strong>HARMONIE_SRC/../util/makeup</strong> , but it doesn&#39;t have to be (e.g. in FMI&#39;s production system the HARMONIE_MAKEUP is situated on a separate disk than the source code HARMONIE_SRC) – and MAKEUP can handle this now.</p><p>The process of building HARMONIE executable contains just a few steps:</p><ol><li>Goto directory HARMONIE_MAKEUP and create/edit your configuration file (config.*). Beware of preferred naming convention:</li></ol><pre><code class="language-bash">config.&lt;MET-INSTITUTE&gt;.&lt;MACHINE-PLATFORM&gt;.&lt;COMPILER-NAME&gt;.&lt;FUNDAMENTAL-OPTIONS&gt;.&lt;OPTIONAL-OPTIONS&gt;</code></pre><ol><li>Run MAKEUP&#39;s configure script under HARMONIE_SRC (for example):</li></ol><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><ol><li>If applicable, adjust environment settings before launching of make. e.g., on some platforms, one needs to remember loading adequate modules, such as for DMI Cray XT5,</li></ol><pre><code class="language-bash">  module swap PrgEnv-pgi PrgEnv-pathscale  # if pathscale is to be used
  module swap xt-mpt xt-mpt/3.5.0
  module swap xt-asyncpe/3.8 xt-asyncpe/3.4</code></pre><ol><li>Goto HARMONIE_SRC directory and type make (or gmake, if make is non-GNU make). Redirect output to a file &amp; terminal:</li></ol><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
gmake 2&gt;&amp;1 |  tee logfile  # ksh/bash
gmake      |&amp; tee logfile  # csh/tcsh</code></pre><h2 id="Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)-1"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)-1">Using MAKEUP to build auxlibs (bufr, gribex, rgb)</a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)-1" title="Permalink"></a></h2><p>You can now build EMOS- and related libraries by using the MAKEUP. All you need to know is what is your <code>sources.</code>&lt;arch&gt; that you would use to build this stuff anyway. Pass that generic name to the MAKEUP&#39;s configure through -E option and you&#39;re in business. An example for FMI&#39;s Cray:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -E sources.crayxt $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><p>This will create extra libs (so called ´´MY_SYSLIBS´´) <code>libbufr.a</code>, <code>libgribex.a</code> and <code>librgb.a</code> and they will end up being linked into your executables, like MASTERODB.</p><h2 id="Using-MAKEUP-to-build-also-util/gl-tools-1"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-also-util/gl-tools-1">Using MAKEUP to build also util/gl -tools</a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-also-util/gl-tools-1" title="Permalink"></a></h2><p>HARMONIE utility package GL as located in util/gl directory can also be built as part of MAKEUP process, if option -G is also given to the configure:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -G $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h2 id="Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools-1"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools-1">Using MAKEUP to build also Oulan and/or Monitor -tools</a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools-1" title="Permalink"></a></h2><p>HARMONIE utility package MONITOR and obs-preprocessor OULAN can also be build with MAKEUP. If you add option -B , then you will get Oulan and Monitor executables built, too. Or you can be more selective and oopt only for oulan with -b oulan, or just monitor -b monitor :</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
# Request for building both oulan &amp; monitor, too
$HARMONIE_MAKEUP/configure -B $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# .. or add oulan only :
$HARMONIE_MAKEUP/configure -b oulan $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# .. or add monitor only :
$HARMONIE_MAKEUP/configure -b monitor $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h2 id="Building-objects-away-from-HARMONIE_SRC-directory-1"><a class="docs-heading-anchor" href="#Building-objects-away-from-HARMONIE_SRC-directory-1">Building objects away from <code>$HARMONIE_SRC</code>-directory</a><a class="docs-heading-anchor-permalink" href="#Building-objects-away-from-HARMONIE_SRC-directory-1" title="Permalink"></a></h2><p>If you do not want to pollute your source directories with objects and thus making it hard to recognize which files are under version handling system SVN and which ain&#39;t (... although SVN command <code>svn -q st</code> would tell ...), then use -P option. This will redirect compilations away from source code, under <code>$HARMONIE_SRC/../makeup.ZZZ</code>, where <code>ZZZ</code> is the suffix of your config-file, e.g. <code>FMI.cray_xt5m.pathscale.mpi+openmp</code>.</p><p>The operation sequence is as follows:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure [options] -P $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
cd $HARMONIE_SRC/../makeup.FMI.cray_xt5m.pathscale.mpi+openmp/src
gmake</code></pre><p>The drawback with this approach is that whenever there is an update in the master source directories, you need to run lengthy <code>configure</code> in order to rsync the working directory up to date. We may need to introduce a separate command for this to avoid full rerun of <code>configure</code>.</p><p>You can also use lowercase -p option with argument pointing to a directory-root, where to compile:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure [options] -p /working/path $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
cd /working/path/src
gmake</code></pre><p>Now, it is important to understand that this <code>/working/path</code> has no connection to version handling i.e. if you change something  in your master copy (say : issue a <code>svn up</code>-command), then your working directory remains unaltered. To synchronize it, do the following:</p><pre><code class="language-bash">#!sh
cd /working/path/src
gmake rsync</code></pre><h2 id="More-details-1"><a class="docs-heading-anchor" href="#More-details-1">More details</a><a class="docs-heading-anchor-permalink" href="#More-details-1" title="Permalink"></a></h2><h3 id="Re-running-configure-1"><a class="docs-heading-anchor" href="#Re-running-configure-1">Re-running configure</a><a class="docs-heading-anchor-permalink" href="#Re-running-configure-1" title="Permalink"></a></h3><p>Afterwards you can rerun configure as many times as you wish.  Please note that the very first time is always slowed (maybe 10 minutes) as interface blocks for arp/ and ald/ projects are generated.</p><p>Usually running configure many times is not necessary – not even when you have changed your config-file (!) – except when interface blocks needs to be updated/re-created (-c or -g options). For example, when subroutine/function call argument list has changed. Then the whole config+build sequence can be run under HARMONIE_SRC as follows:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
# -c option: Check if *some* interface blocks need regeneration and regenerate
$HARMONIE_MAKEUP/configure -c $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# -g option: Force to regenerate interface blocks 
# $HARMONIE_MAKEUP/configure -g $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h3 id="Changing-the-number-of-tasks-for-compilation-1"><a class="docs-heading-anchor" href="#Changing-the-number-of-tasks-for-compilation-1">Changing the number of tasks for compilation</a><a class="docs-heading-anchor-permalink" href="#Changing-the-number-of-tasks-for-compilation-1" title="Permalink"></a></h3><p>The number of tasks used for gmake-compilations is set by default to 8. See NPES parameter in HARMONIE_MAKEUP/defaults.mk To change the default, you can have two choices:</p><ol><li>Add NPES to your config-file, for example set it to 2:</li></ol><pre><code class="language-bash">#!sh
NPES=2</code></pre><ol><li>Invoke gmake with NPES parameter, e.g. set it to 10:</li></ol><pre><code class="language-bash">#!sh
gmake NPES=10</code></pre><h3 id="Inserting-DRHOOK-for-Meso-projects-1"><a class="docs-heading-anchor" href="#Inserting-DRHOOK-for-Meso-projects-1">Inserting DRHOOK for Meso-projects</a><a class="docs-heading-anchor-permalink" href="#Inserting-DRHOOK-for-Meso-projects-1" title="Permalink"></a></h3><p>To insert <code>DrHook</code> profiling automatically for mpa/ and mse/ projects, reconfigure with -H option:</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -H $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><p>You can also pick and choose either mpa/ or mse/ projects with -h option (can be supplied several times):</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -h mpa $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
$HARMONIE_MAKEUP/configure -h mse $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# The following are the same as if the option -H was used
$HARMONIE_MAKEUP/configure -h mpa -h mse -h surfex $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
$HARMONIE_MAKEUP/configure -h mpa:mse:surfex $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><p>In the future it may not be necessary to insert <code>DrHook</code> automagically, if the insertion has been  done in the <code>svn</code> (version handling) level.</p><h3 id="Speeding-up-compilations-by-use-of-RAM-disk-1"><a class="docs-heading-anchor" href="#Speeding-up-compilations-by-use-of-RAM-disk-1">Speeding up compilations by use of RAM-disk</a><a class="docs-heading-anchor-permalink" href="#Speeding-up-compilations-by-use-of-RAM-disk-1" title="Permalink"></a></h3><p>To further speedup compilation and if you have several GBytes of Linux RAM-disk (/dev/shm) available, do the following:</p><ol><li>Create your personal RAM-disk subdirectory and check available disk space</li></ol><pre><code class="language-bash">#!sh
mkdir /dev/shm/$USER
df -kh /dev/shm/$USER</code></pre><ol><li>Reconfigure with RAM-disk either by defining LIBDISK in your config-file or running</li></ol><pre><code class="language-bash">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -L /dev/shm/$USER $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><ol><li>Also define TMPDIR to point to /dev/shm/USER to allow compiler specific temporary files on RAM-disk</li></ol><pre><code class="language-bash">#!sh
# In ksh/bash-shells:
export TMPDIR=/dev/shm/$USER
gmake 2&gt;&amp;1 |  tee logfile
# In csh/tcsh-shells:
setenv TMPDIR /dev/shm/$USER
gmake      |&amp; tee logfile</code></pre><p>Please note that the step-2 creates all libraries AND executablus under the directory pointed by the -L argument. Object files and modules still, however, are placed under corresponding source directories.</p><h3 id="What-if-you-run-out-of-RAM-disk-space-?-1"><a class="docs-heading-anchor" href="#What-if-you-run-out-of-RAM-disk-space-?-1">What if you run out of RAM-disk space ?</a><a class="docs-heading-anchor-permalink" href="#What-if-you-run-out-of-RAM-disk-space-?-1" title="Permalink"></a></h3><p>Sometimes you may find that the disk space becomes limited in /dev/shm/USER. Then you have an option to supply LIBDISK parameter directly to gmake-command without need to reconfigure:</p><pre><code class="language-bash">#!sh
gmake LIBDISK=`pwd`</code></pre><p>This usually increases the throughput time as creation of the AROME executable to disk rather than RAM-disk may be 5-10 times slower. But at least you won&#39;t run out of disk space.</p><hr/><h2 id="How-is-ODB-related-stuff-handled-?-1"><a class="docs-heading-anchor" href="#How-is-ODB-related-stuff-handled-?-1">How is ODB related stuff handled ?</a><a class="docs-heading-anchor-permalink" href="#How-is-ODB-related-stuff-handled-?-1" title="Permalink"></a></h2><p>The <code>Observational DataBase</code> (ODB) is a complicated beast for good reasons. Unlike any other project, which produce just one library per project, correct use of ODB in variational data assimilation requires several libraries.</p><p>The trick to manage this with MAKEUP is to create a bunch of symbolic links pointing to HARMONIE_SRC/odb/ -project directory. There will be one (additional) library for each link. And then we choose carefully the correct subdirectories and source codes therein to be compiled for each library.</p><h3 id="Specific-ODB-libraries,-their-meaning-and-the-source-files-included-1"><a class="docs-heading-anchor" href="#Specific-ODB-libraries,-their-meaning-and-the-source-files-included-1">Specific ODB-libraries, their meaning &amp; the source files included</a><a class="docs-heading-anchor-permalink" href="#Specific-ODB-libraries,-their-meaning-and-the-source-files-included-1" title="Permalink"></a></h3><table><tr><th style="text-align: right"><strong>Library</strong></th><th style="text-align: right"><strong>Description</strong></th><th style="text-align: right"><strong>Source files</strong></th></tr><tr><td style="text-align: right">libodb</td><td style="text-align: right">ODB core library</td><td style="text-align: right">lib/ &amp; aux/ : [a-z]<em>.F90 [a-z]</em>.c</td></tr><tr><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right">module/ &amp; pandor/module : *.F90</td></tr><tr><td style="text-align: right">libodbport</td><td style="text-align: right">Interface between IFS (ARPEGE/ALADIN/AROME) &amp; ODB</td><td style="text-align: right">cma2odb/ &amp; bufr2odb/ : *.F90</td></tr><tr><td style="text-align: right"></td><td style="text-align: right">– also contains BUFR2ODB routines</td><td style="text-align: right">pandor/extrtovs &amp; pandor/fcq &amp; pandor/mandalay : *.F90</td></tr><tr><td style="text-align: right">libodbdummy</td><td style="text-align: right">ODB-related dummies</td><td style="text-align: right">lib/   : [A-Z]<em>.F90 [A-Z]</em>.c</td></tr><tr><td style="text-align: right">libodbmain</td><td style="text-align: right">ODB tools, main programs (C &amp; Fortran)</td><td style="text-align: right">tools/ : [A-Z]*.F90 *.c *.F</td></tr><tr><td style="text-align: right">libPREODB</td><td style="text-align: right">ERA40 database (not needed, but good for debugging)</td><td style="text-align: right">ddl.PREODB/<em>.sql  , ddl.PREODB/</em>.ddl</td></tr><tr><td style="text-align: right">libCCMA</td><td style="text-align: right">Compressed Central Memory Array database (minimization)</td><td style="text-align: right">ddl.CCMA/<em>.sql    , ddl.CCMA/</em>.ddl</td></tr><tr><td style="text-align: right">libECMA</td><td style="text-align: right">Extended Central Memory Array database (obs. screening)</td><td style="text-align: right">ddl.ECMA/<em>.sql    , ddl.ECMA/</em>.ddl</td></tr><tr><td style="text-align: right">libECMASCR</td><td style="text-align: right">Carbon copy of ECMA for obs. load balancing between PEs</td><td style="text-align: right">ddl.ECMASCR/<em>.sql , ddl.ECMASCR/</em>.ddl</td></tr></table><p>From the file HARMONIE_MAKEUP/configure you can also find how different files are nearly hand-picked for particular libraries. Search for block</p><pre><code class="language-bash">#!sh
 if [[ &quot;$d&quot; = @(odb|odbport|odbdummy|odbmain)]] ; then
     case &quot;$d&quot; in
              odb) case &quot;$i&quot; in
                   lib|aux)              files=$(\ls -C1 [a-z]*.F90 [a-z]*.c 2&gt;/dev/null) ;;
                   module|pandor/module) files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   esac ;;
          odbport) case &quot;$i&quot; in
                   cma2odb|bufr2odb)                           files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   pandor/extrtovs|pandor/fcq|pandor/mandalay) files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   esac ;;
         odbdummy) [[ &quot;$i&quot; != &quot;lib&quot;]] || files=$(\ls -C1 [A-Z]*.F90 [A-Z]*.c 2&gt;/dev/null) ;;
          odbmain) [[ &quot;$i&quot; != &quot;tools&quot;]] || files=$(\ls -C1 [A-Z]*.F90 *.c *.F 2&gt;/dev/null) ;;
     esac
 elif [[ &quot;$d&quot; = @($case_odbs)]] ; then
   [[ &quot;$i&quot; != &quot;ddl.$d&quot;]] || {
       files=$(\ls -C1 *.ddl *.sql 2&gt;/dev/null)
       mkdepend=$CMDROOT/sfmakedepend_ODB
   }
 else
  ... </code></pre><h3 id="Handling-SQL-query-and-data-layout-files-1"><a class="docs-heading-anchor" href="#Handling-SQL-query-and-data-layout-files-1">Handling SQL-query and data layout files</a><a class="docs-heading-anchor-permalink" href="#Handling-SQL-query-and-data-layout-files-1" title="Permalink"></a></h3><p>For SQL-query compilations (ODB/SQL queries are translated into C-code for greater performance), <code>odb98.x</code> SQL-compiler executable is also built as a first thing in the MAKEUP process.</p><p>Queries and data definition layouts (DDL-files) are always under &lt;database&gt;/ddl.&lt;database&gt;/ directory.</p><hr/><h2 id="Miscellaneous-stuff-1"><a class="docs-heading-anchor" href="#Miscellaneous-stuff-1">Miscellaneous stuff</a><a class="docs-heading-anchor-permalink" href="#Miscellaneous-stuff-1" title="Permalink"></a></h2><h3 id="Selective-compilation-1"><a class="docs-heading-anchor" href="#Selective-compilation-1">Selective compilation</a><a class="docs-heading-anchor-permalink" href="#Selective-compilation-1" title="Permalink"></a></h3><p>It is very easy to deviate from the generic compilation options for certain source files or even projects. If you want to change compiler option (say) from <strong>-O3</strong> to <strong>-O2</strong> for routine <code>src/arp/pp_obs/pppmer.F90</code>, you can add the following lines at the end of your config-file:</p><pre><code class="language-bash">pppmer.o: FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))</code></pre><p>If you want to apply this to all <code>pppmer*.F90</code>-routines, then you need to enter the following &quot;wildcard&quot;-sequence:</p><pre><code class="language-bash">pppme%.o: FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))</code></pre><p>Note by the way that for some reason we need to use <code>pppme%.o</code> as the more natural (from Unix) <code>pppmer%.o</code> would choose only routines <code>pppmertl.F90</code> and <code>pppmerad.F90</code>, not the routine <code>pppmer.F90</code> at all!</p><p>Applying different compiler flags for project (say) <strong>arp</strong> only, then one can put the following at the end of config-file:</p><pre><code class="language-bash">ifeq ($(PROJ),arp)
%.o:  FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))
endif</code></pre><h3 id="(Re-)building-just-one-project-1"><a class="docs-heading-anchor" href="#(Re-)building-just-one-project-1">(Re-)building just one project</a><a class="docs-heading-anchor-permalink" href="#(Re-)building-just-one-project-1" title="Permalink"></a></h3><p>Sometime you could opt for rebuilding only (say) the <strong>xrd</strong>-project i.e. <strong>libxrd.a</strong>. This can be done as follows:</p><pre><code class="language-bash">#!sh
gmake PROJ=xrd</code></pre><h3 id="Cleaning-up-files-1"><a class="docs-heading-anchor" href="#Cleaning-up-files-1">Cleaning up files</a><a class="docs-heading-anchor-permalink" href="#Cleaning-up-files-1" title="Permalink"></a></h3><p>You can clean up by</p><pre><code class="language-bash">#!sh
gmake clean</code></pre><p>... or selectively just the project <strong>arp</strong>:</p><pre><code class="language-bash">#!sh
gmake PROJ=arp clean</code></pre><p>This clean does <em>not</em> wipe out makefiles i.e. you don&#39;t have to rerun configure after this.</p><h3 id="Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC-1"><a class="docs-heading-anchor" href="#Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC-1">Restoring and cleaning up the state of <code>$HARMONIE_SRC</code></a><a class="docs-heading-anchor-permalink" href="#Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC-1" title="Permalink"></a></h3><p>The following command you can run only once before issuing another configure command. It will remove all related object and executable files as well as generated makefiles, logfiles etc. stuff which was generated by MAKEUP&#39;s configure :</p><pre><code class="language-bash">#!sh
cd $HARMONIE_SRC
gmake veryclean

# .. or alternatively :
$HARMONIE_MAKEUP/unconfigure</code></pre><h3 id="Ignoring-errors-1"><a class="docs-heading-anchor" href="#Ignoring-errors-1">Ignoring errors</a><a class="docs-heading-anchor-permalink" href="#Ignoring-errors-1" title="Permalink"></a></h3><p>Sometimes it is useful to enforce compilations even if one or more routines fail to compile. In such cases recommended syntax is:</p><pre><code class="language-bash">#!sh
gmake -i

# or not to mess up the output, use just one process for compilations

gmake NPES=1 -i</code></pre><h3 id="Creating-precompiled-installation-1"><a class="docs-heading-anchor" href="#Creating-precompiled-installation-1">Creating precompiled installation</a><a class="docs-heading-anchor-permalink" href="#Creating-precompiled-installation-1" title="Permalink"></a></h3><p>If you want to provide precompiled libraries, objects, source code to other users so that they do not have to start compilation from scratch, then make a distribution or precompiled installation as follows:</p><pre><code class="language-bash">#!sh
gmake PRECOMPILED=/a/precompiled/rootdir precompiled</code></pre><p>After this the stuff you just compiled ends up in directory <code>/a/precompiled/rootdir</code> with two subdirectories : <code>src/</code> and <code>util/</code>. All executables are currently removed.</p><p>You can repeat this call, and it will just <code>rsync</code> the modified bits.</p><h3 id="Update/check-your-interface-blocks-outside-configure-1"><a class="docs-heading-anchor" href="#Update/check-your-interface-blocks-outside-configure-1">Update/check your interface blocks outside <code>configure</code></a><a class="docs-heading-anchor-permalink" href="#Update/check-your-interface-blocks-outside-configure-1" title="Permalink"></a></h3><p>The <code>configure</code> has options -c or -g to check up or enforce for (re-)creation of interface blocks of projects <code>arp</code> and <code>ald</code>. To avoid full and lengthy <code>configure</code>-run, you can just do the following:</p><pre><code class="language-bash">#!sh
gmake intfb</code></pre><h2 id="[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../HarmonieSystemDocumentation.md)-1"><a class="docs-heading-anchor" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../HarmonieSystemDocumentation.md)-1"><a href="../HarmonieSystemDocumentation.md">Back to the main page of the HARMONIE System Documentation</a></a><a class="docs-heading-anchor-permalink" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../HarmonieSystemDocumentation.md)-1" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../General/">« General Software Requirements</a><a class="docs-footer-nextpage" href="../StandaloneOdb/">Stand Alone ODB »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 6 September 2021 15:20">Monday 6 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
