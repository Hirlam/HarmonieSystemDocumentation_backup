<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fast start on cca · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../Harmonie-mSMS/">Running at ECMWF</a></li><li class="is-active"><a class="tocitem" href>Fast start on cca</a><ul class="internal"><li><a class="tocitem" href="#Background-1"><span>Background</span></a></li><li><a class="tocitem" href="#What&#39;s-special-with-cca?-1"><span>What&#39;s special with cca?</span></a></li><li><a class="tocitem" href="#How-to-set-it-all-up-1"><span>How to set it all up</span></a></li><li><a class="tocitem" href="#Updated-HARMONIE-configurations-1"><span>Updated HARMONIE configurations</span></a></li></ul></li><li><a class="tocitem" href="../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../Installation/">Installation</a></li><li><a class="tocitem" href="../General/">General Software Requirements</a></li><li><a class="tocitem" href="../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../Content/">Directories</a></li><li><a class="tocitem" href="../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../Namelists/">Namelist</a></li><li><a class="tocitem" href="../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../Screening/">Screening</a></li><li><a class="tocitem" href="../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running at ECMWF and local</a></li><li class="is-active"><a href>Fast start on cca</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fast start on cca</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/Fast_start_on_cca?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Configure-for-faster-setup-on-cca-1"><a class="docs-heading-anchor" href="#Configure-for-faster-setup-on-cca-1">Configure for faster setup on cca</a><a class="docs-heading-anchor-permalink" href="#Configure-for-faster-setup-on-cca-1" title="Permalink"></a></h1><h2 id="Background-1"><a class="docs-heading-anchor" href="#Background-1">Background</a><a class="docs-heading-anchor-permalink" href="#Background-1" title="Permalink"></a></h2><p>Since ECMWF switched from the IBM based c2a to the new Cray XC30 cca setting up and start a new HARMONIE experiment has been a very slow process. With the current settings it may take several hours from the moment you say <strong>Harmonie start</strong> until the code is fully compiled and the real run starts. In the following we describe how to configure your experiment to get started in about half an hour.</p><h2 id="What&#39;s-special-with-cca?-1"><a class="docs-heading-anchor" href="#What&#39;s-special-with-cca?-1">What&#39;s special with cca?</a><a class="docs-heading-anchor-permalink" href="#What&#39;s-special-with-cca?-1" title="Permalink"></a></h2><p>The main cause for the slow synchronization and compilation time on cca is the Lustre file system. Such a file system is optimized for large files but is less efficient for large numbers of small files. As a comparison it takes ~2 minutes to copy the full harmonie system from <code>ecgb:$HOME</code> to <code>$PERM</code> whereas it takes about 1 hour or more to make the same copy to <code>cca:$SCRATCH</code>. It&#39;s not the transfer to cca that takes time but the IO on the <code>$SCRATCH</code> file system.</p><h2 id="How-to-set-it-all-up-1"><a class="docs-heading-anchor" href="#How-to-set-it-all-up-1">How to set it all up</a><a class="docs-heading-anchor-permalink" href="#How-to-set-it-all-up-1" title="Permalink"></a></h2><p>The changes required can be viewed in [13814] and in below we go through what you have to do as a user. At the bottom of the page you&#39;ll find the versions adapted so far.</p><h3 id="Using-the-:PERM-disk-1"><a class="docs-heading-anchor" href="#Using-the-:PERM-disk-1">Using the PERM disk</a><a class="docs-heading-anchor-permalink" href="#Using-the-:PERM-disk-1" title="Permalink"></a></h3><p>Normally HARMONIE is setup to use <code>$SCRATCH</code> as the main disk for both <code>ecgb</code> and <code>cca</code>. Two changes are required in <code>Env_system</code> to use the <code>$PERM</code> disk on <code>cca</code>.</p><ul><li>Set <code>HM_LIB=/hpc$PERM/build_harmonie/$EXP/lib</code> for the <code>ecgb</code> part of <code>Env_system</code></li><li>Set <code>HM_LIB=$PERM/build_harmonie/$EXP/lib</code> for the <code>cca</code> part of <code>Env_system</code></li></ul><p>This means that <code>ecgb:$HM_LIB == cca:$HM_LIB</code> so the synchronization between <code>ecgb</code> and <code>cca</code> is for free. Your working directories and results will still be found under <code>$SCRATCH/hm_home/$EXP</code>.</p><h3 id="Compiling-with-gmkpack-1"><a class="docs-heading-anchor" href="#Compiling-with-gmkpack-1">Compiling with gmkpack</a><a class="docs-heading-anchor-permalink" href="#Compiling-with-gmkpack-1" title="Permalink"></a></h3><p>Harmonie comes with two way of compiling the code, <a href="../HarmonieSystemDocumentation/Build_with_makeup.md">Makeup</a> and <a href="../HarmonieSystemDocumentation/Installation.md">Gmkpack</a>. Both methods have their benefits but in this particular case Gmkpack gives us the fastest throughput for two reasons.</p><ul><li>We only compile the source you have changed for the rest we reuse the already built libraries. This is partly true for Makeup as well but in the search for what to actually compile takes longer time.</li><li>Less disk space and number of inodes is required compared to Makeup. We only copy the code to be compiled.</li></ul><p>The above mentioned is only true if you make small changes for larger number of changes that requires recompilation of big parts of the code it may not necessary be true any longer. To compile with gmkpack set</p><ul><li><code>MAKEUP=no in Env_system</code></li><li>Make sure <code>BUILD_ROOTPACK=no in ecf/config_exp.h</code>. The already compiled libraries are listed below. If you have to compile the full code Makeup is faster.</li></ul><p>The reproducibility between compilation with Makeup and gmkpack has not been checked yet although great care has been taken to use the same compilation options. To avoid unpleasant surprises you are not recommended to change compilation method between to experiments that you expect to compare.</p><h3 id="Things-to-keep-an-eye-on-1"><a class="docs-heading-anchor" href="#Things-to-keep-an-eye-on-1">Things to keep an eye on</a><a class="docs-heading-anchor-permalink" href="#Things-to-keep-an-eye-on-1" title="Permalink"></a></h3><p>The disk space on <code>cca:$PERM</code> is limited not only for the disk space in GB but also for the number of files, the inodes. A typical experiment takes 2.5GB and uses 10000 inodes. Thus the number of experiments you can setup this ways is limited. To check your quota on <code>cca:$PERM</code> type</p><p><code>quota -v</code></p><p>on <code>cca</code>.</p><h3 id="What-about-existing-experiments?-1"><a class="docs-heading-anchor" href="#What-about-existing-experiments?-1">What about existing experiments?</a><a class="docs-heading-anchor-permalink" href="#What-about-existing-experiments?-1" title="Permalink"></a></h3><p>There is not a great need to change your setup if you have a running experiment. The costly part is the initial setup and compilation. If you still feel you would like to do it you are advised to remove everything from <code>cca:$SCRATCH/hm_home/$EXP</code> and <code>ecgb:$SCRATCH/hm_home/$EXP</code> after you have checked that the necessary restart files are available on ecfs. The other alternative is to start a new experiment with the same changes and make sure you start with initial conditions from your old experiment.</p><h2 id="Updated-HARMONIE-configurations-1"><a class="docs-heading-anchor" href="#Updated-HARMONIE-configurations-1">Updated HARMONIE configurations</a><a class="docs-heading-anchor-permalink" href="#Updated-HARMONIE-configurations-1" title="Permalink"></a></h2><p>The changes will progressively be implemented in the used configurations as listed below. If you miss any configuration please contact us. Note that the default settings will not be changed for the tagged versions. Note that for the trunk or for branches a new ROOTPACK is required for every update in the <code>src</code> directory and that the new ROOTPACK may not always be available.</p><pre><code class="language-bash">
  harmonie-38h1

   tags:

   ~hlam/harmonie_release/tags/harmonie-38h1.1 ROOTPACK=/project/hirlam/harmonie/pack/38h1_main.01.gnu.x
   ~hlam/harmonie_release/tags/harmonie-38h1.2 ROOTPACK=/project/hirlam/harmonie/pack/38h1_main.02.gnu.x

   branches:

   ~hlam/harmonie_release/branches/harmonie-38h1 ROOTPACK=/scratch/ms/spsehlam/hlam/common_rootpack/38h1_branch_harmonie_38h1_13749.01.gnu.x
   ~hlam/harmonie_release/branches/harmonEPS-38h1.1 ROOTPACK=/project/harmonie/pack/38h1_harmonEPS_13706.01.gnu.x
                                                    ROOTPACK=/project/harmonie/pack/38h1_harmonEPS_13827.01.gnu.x

  harmonie-40h1

   tags:
   ~hlam/harmonie_release/tags/harmonie-40h1.1.beta.1 ROOTPACK=/project/hirlam/harmonie/pack/40h1_beta_1.01.gnu.x

   branches:

   ~hlam/harmonie_release/trunk ROOTPACK=/scratch/ms/spsehlam/hlam/common_rootpack/40h1_trunk_NNNNN.01.gnu.x

</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Harmonie-mSMS/">« Running at ECMWF</a><a class="docs-footer-nextpage" href="../QuickStartLocal/">Quick start local »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 30 March 2021 17:28">Tuesday 30 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
