<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Obsmon · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox" checked/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Obsmon</a><ul class="internal"><li><a class="tocitem" href="#How-to-turn-on-backend-obsmon?-1"><span>How to turn on backend obsmon?</span></a></li><li><a class="tocitem" href="#How-to-create-statistics-and-SQLite-tables-offline/stand-alone:-1"><span>How to create statistics and SQLite tables offline/stand-alone:</span></a></li><li><a class="tocitem" href="#How-to-visualize-the-SQLite-tables-using-frontend-obsmon:-1"><span>How to visualize the SQLite tables using frontend obsmon:</span></a></li><li><a class="tocitem" href="#How-to-extend-backend-obsmon-with-new-observation-types-1"><span>How to extend backend obsmon with new observation types</span></a></li></ul></li><li><a class="tocitem" href="../Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../xtool/">xtool</a></li><li><a class="tocitem" href="../gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ECFlow tasks</a></li><li><a class="is-disabled">Post Processing</a></li><li class="is-active"><a href>Obsmon</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Obsmon</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/PostPP/Obsmon?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="OBSMON-1"><a class="docs-heading-anchor" href="#OBSMON-1">OBSMON</a><a class="docs-heading-anchor-permalink" href="#OBSMON-1" title="Permalink"></a></h1><p>In 2014 a new version of the observational monitoring system entered trunk. The first official release containing obsmon was cy38h1.2</p><p>The obsmon package consists of two components. The first is a fortran-based code that is run, for all the active observations types (defined in scr/include.ass), at the post-processing stage of an experiment. It generates statistics from the ODB and store data in three SQLite tables (ECMA/CCMA/ECMA_SFC(CANARI)). In addition the SQLite tables are concatenated in tables in the /ts directory at the end of the run.</p><p>The second component is written in R using the Shiny web application framework. It allows the interactive visualization of the data contained in the SQLite tables produced by the first component of the package. This can be done either offline or via a server daemon (e.g. shiny.hirlam.org).</p><p>For disambiguation, we will hereinafter use the terms &quot;backend&quot; and &quot;frontend&quot; to refer to the first and second components of obsmon, respectively.</p><h2 id="How-to-turn-on-backend-obsmon?-1"><a class="docs-heading-anchor" href="#How-to-turn-on-backend-obsmon?-1">How to turn on backend obsmon?</a><a class="docs-heading-anchor-permalink" href="#How-to-turn-on-backend-obsmon?-1" title="Permalink"></a></h2><p>Obsmon is enabled by default in ecf/config_exp.h  vi OBSMONITOR=obstat</p><p>NB1! If you don&#39;t have any log-files from the monitoring experiment, you should disable plotlog from the OBSMONITOR= string in ecf/config_exp.h  NB2! Make sure that the -DODBMONITOR pre-processor flag is active during compilation of util/monitor. This should only be an issue on untested platforms and is by default enabled on ECMWF.</p><h2 id="How-to-create-statistics-and-SQLite-tables-offline/stand-alone:-1"><a class="docs-heading-anchor" href="#How-to-create-statistics-and-SQLite-tables-offline/stand-alone:-1">How to create statistics and SQLite tables offline/stand-alone:</a><a class="docs-heading-anchor-permalink" href="#How-to-create-statistics-and-SQLite-tables-offline/stand-alone:-1" title="Permalink"></a></h2><p>If you are running a normal harmonie experiment with the OBSMONITOR=obstat active, the following step is not relevant.</p><p>Two new actions are implemented in the Harmonie script. Instead of start you can write obsmon and instead of prod you can write obsmonprod. This will use the correct definition file and only do post-processing. If you have your ODB files in another experiment you can add the variable OBSMON<em>EXP</em>ARCHIVE<em>ROOT to point to the archive directory in the experiment you are monitoring. This approach is used in the operational MetCoOp runs. If you set OBSMON</em>EXP=label the runs will be stored in EXTRARCH/label/. This way you can use the same experiment to monitor all other experiments. The experiements do not need to belong to you as long as you have reading permissions to the experiment. </p><pre><code class="language-bash">1. as start:
${HM_REV}/config-sh/Harmonie obsmon DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH OBSMON_EXP_ARCHIVE_ROOT=PATH-TO-ARCHIVE-DIRECTORY-TO-MONITOR OBSMON_EXP=MY-LABEL</code></pre><pre><code class="language-bash">2. as prod:
${HM_REV}/config-sh/Harmonie obsmonprod DTGEND=YYYYMMDDHH OBSMON_EXP_ARCHIVE_ROOT=PATH-TO-ARCHIVE-DIRECTORY-TO-MONITOR OBSMON_EXP=MY-LABEL</code></pre><p>If you want to monitor an experiment stored on ECFS, you should specify OBSMON<em>EXP</em>ARCHIVE_ROOT with the full address (ectmp:/<span>$USER/..... or ec:/$</span>USER/...) e.g. </p><pre><code class="language-bash">OBSMON_EXP_ARCHIVE_ROOT=ectmp:/$USER/harmonie/MY-EXP OBSMON_EXP=MY-LABEL</code></pre><p>You can also monitor other users experiments as long as you have read-access to the data.</p><h2 id="How-to-visualize-the-SQLite-tables-using-frontend-obsmon:-1"><a class="docs-heading-anchor" href="#How-to-visualize-the-SQLite-tables-using-frontend-obsmon:-1">How to visualize the SQLite tables using frontend obsmon:</a><a class="docs-heading-anchor-permalink" href="#How-to-visualize-the-SQLite-tables-using-frontend-obsmon:-1" title="Permalink"></a></h2><p>Download the code from its git repo at hirlam.org:</p><pre><code class="language-bash">git clone https://git.hirlam.org/Obsmon obsmon</code></pre><p>Instructions on how to install, configure and run the code can be found in the file <code>docs/obsmon_documentation.pdf</code> that is shipped with the code.</p><h2 id="How-to-extend-backend-obsmon-with-new-observation-types-1"><a class="docs-heading-anchor" href="#How-to-extend-backend-obsmon-with-new-observation-types-1">How to extend backend obsmon with new observation types</a><a class="docs-heading-anchor-permalink" href="#How-to-extend-backend-obsmon-with-new-observation-types-1" title="Permalink"></a></h2><h3 id="Step-1:-Extract-statistics-from-ODB-1"><a class="docs-heading-anchor" href="#Step-1:-Extract-statistics-from-ODB-1">Step 1: Extract statistics from ODB</a><a class="docs-heading-anchor-permalink" href="#Step-1:-Extract-statistics-from-ODB-1" title="Permalink"></a></h3><p>In the scripts you must enable monitoring of your observation type. Each observation type is monitored if active in:</p><pre><code class="language-bash">msms/harmonie.tdf</code></pre><p>The script which calls the obsmon binary, is:</p><pre><code class="language-bash">scr/obsmon_stat</code></pre><p>This script set the correct namelist based on how you define your observation below. </p><p>After the information is extracted, the different SQLite bases are gathered into one big SQLite file in the script:</p><pre><code class="language-bash">scr/obsmon_link_stat</code></pre><p>The observation types which the above script is gathering is defined in obtypes in this script:</p><pre><code class="language-bash">util/monitor/scr/monitor.inc</code></pre><p>Then let us introduce the new observation in the obsmon binary. The source code is in </p><pre><code class="language-bash">harmonie/util/monitor</code></pre><p>There are two modules controlling the extraction from ODB:</p><pre><code class="language-bash">mod/module_obstypes.f90
mod/module_obsmon.F90</code></pre><p>The first routine defines and initializes the observation type you want to monitor. The second calls the intialization defined in the first file. The important steps are to introduce namelist variables and a meaningful definition in the initialization of the observation type.</p><p>The real extraction from ODB is done in</p><pre><code class="language-bash">cmastat/odb_extract.f90</code></pre><p>At the moment there are two different SQL files used, one for conventional and one for satelites. E.g. radar is handled as TEMP/AIRCRAFT.</p><h3 id="Step-2:-Visualize-the-new-observation-in-shiny-(frontend-obsmon)-1"><a class="docs-heading-anchor" href="#Step-2:-Visualize-the-new-observation-in-shiny-(frontend-obsmon)-1">Step 2: Visualize the new observation in shiny (frontend obsmon)</a><a class="docs-heading-anchor-permalink" href="#Step-2:-Visualize-the-new-observation-in-shiny-(frontend-obsmon)-1" title="Permalink"></a></h3><p>The logics of which observation type to display is defined in:</p><pre><code class="language-bash">src/observation_definitions.R</code></pre><p>In case of a new plot added, the plotting is defined in the files under:</p><pre><code class="language-bash">src/plots</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Forecast/">« Forecast</a><a class="docs-footer-nextpage" href="../Diagnostics/">Diagnostics »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 6 September 2021 15:27">Monday 6 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
