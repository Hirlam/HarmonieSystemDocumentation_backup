<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fullpos · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox" checked/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../xtool/">xtool</a></li><li><a class="tocitem" href="../gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../Extract4verification/">-</a></li></ul></li><li class="is-active"><a class="tocitem" href>Fullpos</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li><li><a class="tocitem" href="#ecf/config_exp.h-1"><span>ecf/config_exp.h</span></a></li><li><a class="tocitem" href="#FULL-POS-1"><span>FULL-POS</span></a></li><li><a class="tocitem" href="#Parameter-selection-1"><span>Parameter selection</span></a></li><li><a class="tocitem" href="#Add-new-output-1"><span>Add new output</span></a></li><li><a class="tocitem" href="#Expert-users-1"><span>Expert users</span></a></li><li><a class="tocitem" href="#Problems-1"><span>Problems</span></a></li><li><a class="tocitem" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../../HarmonieSystemDocumentation.md)-1"><span>Back to the main page of the HARMONIE System Documentation</span></a></li></ul></li><li><a class="tocitem" href="../FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ECFlow tasks</a></li><li><a class="is-disabled">Post Processing</a></li><li class="is-active"><a href>Fullpos</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fullpos</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/PostPP/Fullpos?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Postprocessing-with-FULL-POS-1"><a class="docs-heading-anchor" href="#Postprocessing-with-FULL-POS-1">Postprocessing with FULL-POS</a><a class="docs-heading-anchor-permalink" href="#Postprocessing-with-FULL-POS-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>FULL-POS is a powerful postprocessing package, which is part of the  common ARPEGE/IFS cycle. FULL-POS is documented by </p><ul><li><a href="http://www.cnrm.meteo.fr/gmapdoc/spip.php?article157">Yessad (2011)</a>: This documentation describes the software FULL-POS doing post-processing on different kind of vertical levels. In particular, post-processable variables and organigramme are given. Some aspects of horizontal and vertical interpolators (which may be used in some other applications) are also described.</li><li><a href="http://www.cnrm.meteo.fr/gmapdoc/IMG/pdf/ykfpos38.pdf">ykfpos38.pdf</a>: FULL-POS in cycle 38</li><li><a href="http://www.cnrm.meteo.fr/gmapdoc/spip.php?article17">El Khatib (2002)</a>: Older documentation with a link to an old FULL-POS website.</li></ul><p>FULL-POS is a special configuration (9xx) of the full model for setup and initialization. In other words it is a 0 hour forecast, with extra namelist settings for variables to (post)process and to write out. When generating initial or boundary files we are calling a special configuration of FULL-POS, e927.</p><h2 id="ecf/config_exp.h-1"><a class="docs-heading-anchor" href="#ecf/config_exp.h-1">ecf/config_exp.h</a><a class="docs-heading-anchor-permalink" href="#ecf/config_exp.h-1" title="Permalink"></a></h2><p>The use of FULL-POS is controlled by the POSTP variable in the [source:Harmonie/ecf/config_exp.h] file:</p><pre><code class="language-bash">POSTP=&quot;inline&quot;                          # Postprocessing by Fullpos (inline|offline|none).
                                        # See Setup_postp.pl for selection of fields.
                                        # inline: this is run inside of the forecast
                                        # offline: this is run in parallel to the forecast in a separate task</code></pre><p>&quot;inline&quot; is the default which means FULL-POS postprocessing is called from the forecast model as it runs. If you select &quot;offline&quot; the model is called independently of the running forecast model using the forecast model output files as inputs to be postprocessed. By selecting &quot;none&quot; no FULL-POS postprocessing will be carried out.</p><p>Output frequency by FULL-POS is controlled by PWRITUPTIMES, FPOUTINT and FREQ_RESET:</p><pre><code class="language-bash"># Postprocessing times (space separated list)
PWRITUPTIMES=&quot;03 06 09 12 15 18 21 24 30 36 42 48 54 60&quot;
FPOUTINT=&quot;-1&quot;                           # Regular  interval if &gt; 0. Not used if &lt;= 0.

FREQ_RESET=3                            # Reset frequency of max/min values in hours, controls NRAZTS</code></pre><h2 id="FULL-POS-1"><a class="docs-heading-anchor" href="#FULL-POS-1">FULL-POS</a><a class="docs-heading-anchor-permalink" href="#FULL-POS-1" title="Permalink"></a></h2><p>The use of FULL-POS is controlled by the following namelists: NAMFPPHY, NAMFPDY2, NAMFPDYP, NAMFPDYH, NAMFPDYI, NAMFPDYV, NAMFPDYT and NAMFPDYS. These namelists can be used to make an accurate list of post- processed fields. It is possible to call FULL-POS when running the model. In such a configuration we can configure HARMONIE to write some parameters with a different frequency than the standard historical files produced. </p><p>However, with &quot;inline&quot; postprocessing, it is possible to get, at each post-processing time step, exactly the fields you wish. In this case, you have to make other namelists file which will contain the selection of the fields you wish to get. First, you have to set in NAMCT0 the variable CNPPATH as the directory where the selection files will be. Under this directory, the name of a selection file must be xxtDDDDHHMM, where DDDDHHMM specifies the date/time of the post-processing time step.</p><p>The <a href="https://hirlam.org/trac/browser/Harmonie/scr/Postpp">Postpp</a> script executes the &quot;offline&quot; FULL-POS postprocessing in HARMONIE system. </p><p>The management of FULL-POS and the creation of selection files is made easier for the user by the  <a href="https://hirlam.org/trac/browser/Harmonie/scr/Select_postp.pl">Select_postp.pl</a> perl script. </p><h2 id="Parameter-selection-1"><a class="docs-heading-anchor" href="#Parameter-selection-1">Parameter selection</a><a class="docs-heading-anchor-permalink" href="#Parameter-selection-1" title="Permalink"></a></h2><p>Some of the more relevant entries in this script:</p><ul><li><strong>CFP2DF</strong>: names of the 2D dynamics fields to be post-processed. Names have at maximum 16 characters. By default CFP2DF contains blanks (no 2D dynamical field to post-process).</li><li><strong>CFP3DF</strong>: names of the 3D dynamics fields to be post-processed. Names have at maximum 12 characters. By default CFP3DF contains blanks (no 3D dynamical field to post-process).</li><li><strong>CFPPHY</strong>: names of the physical fields to be post-processed. Names have at maximum 16 characters. By default CFPPHY contains blanks (no physical field to post-process). </li><li><strong>CFPXFU</strong>:  names of the instantaneous fluxes fields to be post-processed. Names have at maximum 16 characters. By default CFPXFU contains blanks (no instantaneous fluxes field to post-process).</li><li><strong>CFPCFU</strong>: names of the cumulated fluxes fields to be post-processed. Names have at maximum 16 characters. By default CFPCFU contains blanks (no cumulated fluxes field to post-process).</li></ul><p>You can define the levels you wish to output using the following variable:</p><ul><li><strong>NRFP3S</strong>: model levels to postprocess</li><li><strong>RFP3H</strong>: height above ground levels to postprocess</li><li><strong>RFP3P</strong>: pressure levels to postprocess</li><li><strong>RFP3PV</strong>: PV levels to postprocess</li><li><strong>RFP3I</strong>: temperature levels to postprocess</li></ul><h2 id="Add-new-output-1"><a class="docs-heading-anchor" href="#Add-new-output-1">Add new output</a><a class="docs-heading-anchor-permalink" href="#Add-new-output-1" title="Permalink"></a></h2><p>This section provides a simple example on how to add a new parameter/vertical level for postprocessing in <a href="https://hirlam.org/trac/browser/Harmonie/scr/Select_postp.pl">Select_postp.pl</a>.</p><p>To add new &quot;height above ground&quot; output at 150m to the FULL-POS output, two changes are required:</p><ul><li>Add the new height, 150., to the RFP3H array</li><li>Add level array number to the @namfpdyh_lev level selection</li></ul><pre><code class="language-bash">cd $HOME/hm_home/levexp
$PATH_TO_HARMONIE/config-sh/Harmonie co scr/Select_postp.pl
cp scr/Select_postp.pl scr/Select_postp.pl.ori
### edit scr/Select_postp.pl
diff scr/Select_postp.pl scr/Select_postp.pl.ori
83c83
&lt;  RFP3H =&gt; [&#39;20.&#39;,&#39;50.&#39;,&#39;100.&#39;,&#39;150.&#39;,&#39;250.&#39;,&#39;500.&#39;,&#39;750.&#39;,&#39;1000.&#39;,&#39;1250.&#39;,&#39;1500.&#39;,&#39;2000.&#39;,&#39;2500.&#39;,&#39;3000.&#39;],
---
&gt;  RFP3H =&gt; [&#39;20.&#39;,&#39;50.&#39;,&#39;100.&#39;,&#39;250.&#39;,&#39;500.&#39;,&#39;750.&#39;,&#39;1000.&#39;,&#39;1250.&#39;,&#39;1500.&#39;,&#39;2000.&#39;,&#39;2500.&#39;,&#39;3000.&#39;],
132c132
&lt;  @namfpdyh_lev = (1,2,3,4,5,6,7,8,9,10,11,12,13) ;
---
&gt;  @namfpdyh_lev = (1,2,3,4,5,6,7,8,9,10,11,12) ;</code></pre><h2 id="Expert-users-1"><a class="docs-heading-anchor" href="#Expert-users-1">Expert users</a><a class="docs-heading-anchor-permalink" href="#Expert-users-1" title="Permalink"></a></h2><p>In the FULL-POS namelist NAMFPC (variables explained in <a href="https://hirlam.org/trac/browser/Harmonie/src/arp/module/yomfpc.F90">yomfpc.F90</a>), the variables are placed into different categories:</p><ul><li>LFPCAPEX: if true XFU fields used for CAPE and CIN computation (with NFPCAPE).</li><li>LFPMOIS: month allowed for climatology usage:<ul><li>.F. =&gt; month of the model (forecast).</li><li>.T. =&gt; month of the file.</li></ul></li><li>NFPCLI:  usage level for climatology:<ul><li>0: no climatology</li><li>1: orography and land-sea mask of output only</li><li>2: all available climatological fields of the current month</li><li>3: shifting mean from the climatological fields of the current month to the ones of the closest month</li></ul></li><li>NFPCAPE: kind of computation for CAPE and CIN:<ul><li>1 =&gt; from bottom model layer</li><li>2 =&gt; from the most unstable layer</li><li>3 =&gt; from mto standard height (2 meters) as recomputed values</li><li>4 =&gt; from mto standard height (2 meters) out of fluxes (for analysis)</li></ul></li><li>CFPFMT:  format of the output files, can take the following values:<ul><li>’MODEL’ for output in spherical harmonics.</li><li>’GAUSS’ for output in grid-point space on Gaussian grid (covering the global sphere).</li><li>’LELAM’ for output on a grid of kind ’ALADIN’ (spectral or grid-point coefficients).</li><li>’LALON’ for a grid of kind &quot;latitudes * longitudes&quot;.</li></ul></li></ul><p>Default is ’GAUSS’ in ARPEGE/IFS, ’LELAM’ in ALADIN.</p><ul><li>CFPDOM: names of the subdomains. Names have at maximum 7 characters.<ul><li>If CFPFMT=’GAUSS’ or ’LELAM’ only one output domain is allowed.</li><li>If CFPFMT=’LALON’ the maximum of output subdomains allowed is 10.</li></ul>By default, one output domain is requested, CFPDOM(1)=’000’ and CFPDOM(i)=’’ for i&gt;1.</li><li>L<em>READ</em>MODEL_DATE:  if: .TRUE. read date from the model</li></ul><p>The default FA-names for parameters in different categories can be found from <a href="https://hirlam.org/trac/browser/Harmonie/src/arp/setup/suafn1.F90#L687">suafn1.F90</a>.</p><p>It&#39;s worth mentioning some of the variables postprocessed by FULL-POS</p><ul><li>True vertical velocity w <a href="PostPP/for NH ALADIN only">VW</a>.</li><li>Potential vorticity P V [PV].</li><li>Pressure coordinate vertical velocity ω [VV].</li><li>Eta coordinate vertical velocity η [ETAD].</li><li>Absolute vorticity ζ + f [ABS].</li><li>Relative vorticity ζ [VOR].</li><li>Divergence D [DIV].</li><li>Satellite equivalents</li><li>MSAT7 MVIRI channels 1 and 2 ([MSAT7C1] and [MSAT7C2]).</li><li>MSAT8 MVIRI channels 1 to 8 ([MSAT8C1] to [MSAT8C8]).</li><li>MSAT9 MVIRI channels 1 to 8 ([MSAT9C1] to [MSAT9C8]).</li><li>GOES11 IMAGER channels 1 to 4 ([GOES11C1] to [GOES11C4]).</li><li>GOES12 IMAGER channels 1 to 4 ([GOES12C1] to [GOES12C4]).</li><li>MTSAT1 IMAGER channels 1 to 4 ([MTSAT1C1] to [MTSAT1C4]).</li></ul><h2 id="Problems-1"><a class="docs-heading-anchor" href="#Problems-1">Problems</a><a class="docs-heading-anchor-permalink" href="#Problems-1" title="Permalink"></a></h2><p>Problems may be encountered with FULL-POS when running on large domains. Here are some things to look out for:</p><ul><li>Increase the MBX_SIZE if you run out of MPI buffer space. </li><li>Increase number of cores if you run out of memory.</li><li>Make sure NFPROMA and NFPROMA_DEP are small and equal to NPROMA.</li><li>Set NSTRIN=NSTROUT=NPROC in nampar0 if one of the above mentioned doesn&#39;t help.</li></ul><h2 id="[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../../HarmonieSystemDocumentation.md)-1"><a class="docs-heading-anchor" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../../HarmonieSystemDocumentation.md)-1"><a href="../HarmonieSystemDocumentation.md">Back to the main page of the HARMONIE System Documentation</a></a><a class="docs-heading-anchor-permalink" href="#[Back-to-the-main-page-of-the-HARMONIE-System-Documentation](../../HarmonieSystemDocumentation.md)-1" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Extract4verification/">« -</a><a class="docs-footer-nextpage" href="../FileConversions/">FileConversion »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 30 March 2021 17:19">Tuesday 30 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
