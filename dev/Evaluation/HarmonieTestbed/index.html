<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Testbed · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li class="is-active"><a class="tocitem" href>Testbed</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-configurations-1"><span>Defining the configurations</span></a></li><li><a class="tocitem" href="#Testbed-members-1"><span>Testbed members</span></a></li><li><a class="tocitem" href="#Testbed-domains-1"><span>Testbed domains</span></a></li><li><a class="tocitem" href="#The-playfile-1"><span>The playfile</span></a></li><li><a class="tocitem" href="#Input-data-1"><span>Input data</span></a></li><li><a class="tocitem" href="#Starting-the-testbed-1"><span>Starting the testbed</span></a></li><li><a class="tocitem" href="#Evaluation-of-the-result-1"><span>Evaluation of the result</span></a></li><li><a class="tocitem" href="#When-to-use-the-testbed-1"><span>When to use the testbed</span></a></li></ul></li><li><a class="tocitem" href="../Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Testbed and Mitraillette</a></li><li class="is-active"><a href>Testbed</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Testbed</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/Evaluation/HarmonieTestbed?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-HARMONIE-testbed-1"><a class="docs-heading-anchor" href="#The-HARMONIE-testbed-1">The HARMONIE testbed</a><a class="docs-heading-anchor-permalink" href="#The-HARMONIE-testbed-1" title="Permalink"></a></h1><p>The HARMONIE testbed provides a facility to run a number of well defined test cases using the existing script environment in HARMONIE. The ALADIN testbed, <a href="../HarmonieSystemDocumentation/Evaluation/Mitraillette.md">mitraillette</a> runs test on the hart of the model, the dynamical core. The HARMONIE testbed tests the full script system as it is supposed to be used.</p><h2 id="Defining-the-configurations-1"><a class="docs-heading-anchor" href="#Defining-the-configurations-1">Defining the configurations</a><a class="docs-heading-anchor-permalink" href="#Defining-the-configurations-1" title="Permalink"></a></h2><h3 id="General-1"><a class="docs-heading-anchor" href="#General-1">General</a><a class="docs-heading-anchor-permalink" href="#General-1" title="Permalink"></a></h3><p>The testbed is a suite that launches and follows new experiments one at a time in a controlled environment. The testbed experiment takes care of compilation and also hosts the climate files generated by the tested configurations. Source and scripts changes shall be done in the testbed experiment and will be synchronized to the child experiment using the hm_CMODS option in HARMONIE. </p><p>A number of basic configurations have been defined in <a href="https://hirlam.org/trac/browser/Harmonie/scr/Harmonie_configurations.pm">Harmonie_configurations.pm</a> as the deviation from the default setup in  <a href="https://hirlam.org/trac/browser/Harmonie/ecf/config_exp.h">config_exp.h</a>, <a href="https://hirlam.org/trac/browser/Harmonie/scr/include.ass">include.ass</a> and <a href="https://hirlam.org/trac/browser/Harmonie/suites/harmonie.pm">harmonie.pm</a>. These configurations are controlled by the script  <a href="https://hirlam.org/trac/browser/Harmonie/scr/Harmonie_testbed.pl">Harmonie_testbed.pl</a>. The script also contains a number of extra configurations tested from time to time. With the current settings, a test of AROME without 3DVAR would look like.</p><pre><code class="language-bash">
    # AROME no 3D-VAR but default blending of upper air from boundaries
    &#39;AROME&#39; =&gt; {
      &#39;description&#39; =&gt; &#39;Standard AROME settings without upper air DA&#39;,
      &#39;PHYSICS&#39;     =&gt; &#39;arome&#39;,
      &#39;SURFACE&#39;     =&gt; &#39;surfex&#39;,
      &#39;DYNAMICS&#39;    =&gt; &#39;nh&#39;,
      &#39;ANAATMO&#39;     =&gt; &#39;blending&#39;,
      &#39;ANASURF&#39;     =&gt; &#39;none&#39;,
      &#39;DFI&#39;         =&gt; &#39;none&#39;,
      &#39;HOST_MODEL&#39;  =&gt; &#39;ifs&#39;,
      &#39;DOMAIN&#39;      =&gt; &#39;DKCOEXP&#39;,
      &#39;VLEV&#39;        =&gt; &#39;65&#39;,
      &#39;BDINT&#39;       =&gt; &#39;3&#39;,
    },
</code></pre><p>The resulting output, in this case from AROME<em>BD</em>ARO running at ECMWF would look like:</p><pre><code class="language-bash">
 Using the configuration AROME_BD_ARO


 Input /gpfs/scratch/ms/spsehlam/hlam/test_harmonie/ecgb_c2a_testbed_trunk_mkp_12413/ecf/config_exp.h  
 Output ecf/config_exp.h  

 Change BUILD=${BUILD-yes}                     to BUILD=no 
 Change       BUILD_ROOTPACK=no to BUILD_ROOTPACK=no 
 Change BINDIR=${BINDIR-$HM_DATA/bin}                 to BINDIR=$HM_COMDAT/ecgb_c2a_testbed_trunk_mkp_12413/bin 
 Change DOMAIN=DKCOEXP                          to DOMAIN=TEST_8 
 Change VLEV=65                                 to VLEV=HIRLAM_60 
 Change LL=${LL-06}                             to LL=6 
 Change DYNAMICS=&quot;nh&quot;                           to DYNAMICS=nh 
 Change PHYSICS=&quot;arome&quot;                         to PHYSICS=arome 
 Change SURFACE=&quot;surfex&quot;                        to SURFACE=surfex 
 Change DFI=&quot;none&quot;                              to DFI=none 
 Change ANAATMO=3DVAR                           to ANAATMO=none 
 Change ANASURF=CANARI_OI_MAIN                  to ANASURF=none 
 Change OBDIR=$HM_DATA/observations             to OBDIR=$HM_DATA/../ecgb_c2a_testbed_trunk_mkp_12413/observations/ 
 Change HOST_MODEL=&quot;ifs&quot;                        to HOST_MODEL=aro 
 Change HOST_SURFEX=&quot;no&quot;                        to HOST_SURFEX=yes 
 Change SURFEX_INPUT_FORMAT=lfi                 to SURFEX_INPUT_FORMAT=fa 
 Change BDLIB=ECMWF                             to BDLIB=AROME 
 Change BDDIR=$HM_DATA/${BDLIB}/archive/@YYYY@/@MM@/@DD@/@HH@   to BDDIR=$HM_DATA/../ecgb_c2a_testbed_trunk_mkp_12413/archive_AROME/@YYYY@/@MM@/@DD@/@HH@/ 
 Change INT_BDFILE=$WRK/ELSCF${CNMEXP}ALBC@NNN@                 to INT_BDFILE=$ARCHIVE_ROOT/$YY/$MM/$DD/$HH/ELSCF${CNMEXP}ALBC@NNN@ 
 Change BDSTRATEGY=simulate_operational to BDSTRATEGY=same_forecast 
 Change BDINT=1                         to BDINT=3 
 Change SURFEX_PREP=&quot;no&quot;                to SURFEX_PREP=yes 
 Change CLIMDIR=$HM_DATA/climate                to CLIMDIR=$HM_DATA/../ecgb_c2a_testbed_trunk_mkp_12413/climate/$DOMAIN/$PHYSICS 
 Change BDCLIM=$HM_DATA/${BDLIB}/climate        to BDCLIM=$HM_DATA/../ecgb_c2a_testbed_trunk_mkp_12413/climate/TEST_11/arome/ 
 Change INT_SINI_FILE=$WRK/SURFXINI.$SURFEX_OUTPUT_FORMAT       to INT_SINI_FILE=$ARCHIVE_ROOT/$YY/$MM/$DD/$HH/SURFXINI.$SURFEX_OUTPUT_FORMAT 
 Change ARCHIVE_ECMWF=yes                       to ARCHIVE_ECMWF=no 
 Change POSTP=&quot;inline&quot;                          to POSTP=inline 
 Change MAKEGRIB=no                             to MAKEGRIB=yes 
 Add new settings JBDIR=$HM_REV/testbed_data/jb_data 
 Add new settings LARGE_EC_BD=no 
 Add new settings PLAYFILE=harmonie 
 Add new settings config=AROME 


 Input /gpfs/scratch/ms/spsehlam/hlam/test_harmonie/ecgb_c2a_testbed_trunk_mkp_12413/Env_submit 
 Output Env_submit 

 Change $nprocx=16; to $nprocx=2 
 Change $nprocy=16; to $nprocy=2 
 Change $nprocx=8; to $nprocx=2 
 Change $nprocy=16; to $nprocy=2 
</code></pre><p>As seen from the example above the script also changes the submission rules. These rules can be defined, per host, at the end of the script. Other host specific settings may also be defined to allow local changes of the test environment. In Harmonie_testbed.pl we find e.g. changes for ecgate:</p><pre><code class="language-bash">
 &#39;ecgate&#39; =&gt; {
   &#39;BINDIR&#39;     =&gt; &#39;$HM_COMDAT/&#39;.$EXP.&#39;/bin&#39;,
   &#39;BDDIR&#39;      =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/$BDLIB/$DOMAIN&#39;,
   &#39;OBDIR&#39;      =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/observations/$DOMAIN&#39;,
   &#39;LARGE_EC_BD&#39; =&gt; &#39;no&#39;,
   &#39;CLIMDIR&#39;    =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/climate/$DOMAIN/$PHYSICS&#39;,
  },
</code></pre><p>The host dependent settings will be imposed on all configurations. If a setting in any configuration is in conflict with the host settings the configuration settings will be used.</p><h3 id="Define-changes-in-harmonie.pm-1"><a class="docs-heading-anchor" href="#Define-changes-in-harmonie.pm-1">Define changes in harmonie.pm</a><a class="docs-heading-anchor-permalink" href="#Define-changes-in-harmonie.pm-1" title="Permalink"></a></h3><p>The changes to msms/harmonie.pm are controlled with a special syntax, like in the AROME_JB configuration.</p><pre><code class="language-bash">   # AROME Structure function derivation
   &#39;AROME_JB&#39; =&gt; {
     &#39;description&#39; =&gt; &#39;Derive structure functions for AROME 3DVAR&#39;,
      ...
      &#39;harmonie.pm&#39; =&gt; [&#39;ENSBDMBR&#39;,&#39;ENSCTL&#39;,&#39;SLAFLAG&#39;],
        &#39;ENSBDMBR&#39;    =&gt; &#39;[1,2,3,4]&#39;,
        &#39;ENSCTL&#39;      =&gt; &#39;[&quot;001&quot;,&quot;002&quot;,&quot;003&quot;,&quot;004&quot;]&#39;,
        &#39;SLAFLAG&#39;     =&gt; &#39;[0]&#39;,
    },
</code></pre><p>The harmonie.pm key determines which keyword to find and replace. The list guarantees that the same keywords are not changed in e.g. ecf/config_exp.h .</p><h2 id="Testbed-members-1"><a class="docs-heading-anchor" href="#Testbed-members-1">Testbed members</a><a class="docs-heading-anchor-permalink" href="#Testbed-members-1" title="Permalink"></a></h2><table><tr><th style="text-align: right">=Name                 =</th><th style="text-align: right">=DOMAIN       =</th><th style="text-align: right">=DTGs                  =</th><th style="text-align: right">=Dependencies =</th><th style="text-align: right">=Description                                 =</th><th style="text-align: right">=Active in =</th></tr><tr><td style="text-align: right">AROME</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME with 2-D decomposition</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME_1D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME with 1-D decomposition</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME_2D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME with 2-D decomposition</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME_3DVAR</td><td style="text-align: right">IRELAND150</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME_3DVAR</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME<em>3DVAR</em>MARSOBS</td><td style="text-align: right">IRELAND150</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME_3DVAR including non-conventional observations from MARS</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME<em>3DVAR</em>2P</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME_3DVAR with two patches</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME_4DVAR</td><td style="text-align: right">SCANDINAVIA</td><td style="text-align: right">!2017093021-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME_4DVAR</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>BD</em>ALA</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">ALARO</td><td style="text-align: right">AROME with ALARO LBCs</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>BD</em>ALA_ARO</td><td style="text-align: right">TEST_2.5</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME<em>BD</em>ALA</td><td style="text-align: right">AROME with AROME LBCs</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>BD</em>ARO</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME</td><td style="text-align: right">AROME with AROME LBCs, no IO-server</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME<em>BD</em>ARO<em>IO</em>SERV</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME</td><td style="text-align: right">AROME with AROME LBCs, with IO-server</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME<em>BD</em>ARO_2P</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME</td><td style="text-align: right">AROME two patches with AROME LBCs</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME_CLIMSIM</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2012053100-!2012060200</td><td style="text-align: right">None</td><td style="text-align: right">AROME climate simulation, netcdf output</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME_EKF</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME with CANARI<em>EKF</em>SURFEX</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>EPS</em>COMP</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">HarmonEPS</td><td style="text-align: right">AROME_3DVAR comparison of EPS control</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME_MUSC</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME</td><td style="text-align: right">AROME MUSC</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">AROME_NONE</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME no SFC/UA DA</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>NONE</em>2D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">AROME no SFC/UA DA</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>NONE</em>BD<em>ALA</em>NONE</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">ALARO_NONE</td><td style="text-align: right">AROME no SFC/UA DA with ALARO LBCs</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">AROME<em>NONE</em>BD<em>ARO</em>NONE</td><td style="text-align: right">TEST_8</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME_NONE</td><td style="text-align: right">AROME no SFC/UA DA with AROME LBCs</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ARONE_JB</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">Generation of JB statistics</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">HarmonEPS</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">AROME<em>EPS</em>COMP</td><td style="text-align: right">HarmonEPS</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">HarmonEPS_IFSENSBD</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2019111021-!2019111103</td><td style="text-align: right">AROME<em>EPS</em>COMP</td><td style="text-align: right">HarmonEPS with IFSENS boundaries</td><td style="text-align: right">CY43</td></tr><tr><td style="text-align: right">ALARO1<em>3DVAR</em>OLD</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO1 with 3DVAR and old_surface</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_1D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with 1-D decomposition</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_2D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with 2-D decomposition</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>3DVAR</em>OLD</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO<em>3DVAR with old</em>surface</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_EKF</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with CANARI<em>EKF</em>SURFEX</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>EPS</em>COMP</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">???</td><td style="text-align: right">ALARO EPS?</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>MF</em>60</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with VLEV=MF_60</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_MUSC</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">ALARO</td><td style="text-align: right">ALARO MUSC</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>NH</em>1D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with NH dynamics and 1-D decomposition</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>NH</em>2D</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with NH dynamics and 2-D decomposition</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_NONE</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with no SFC/UA DA</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO_OLD</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">None</td><td style="text-align: right">ALARO with old_surface</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">ALARO<em>OLD</em>MUSC</td><td style="text-align: right">TEST_11</td><td style="text-align: right">!2017093018-!2017100100</td><td style="text-align: right">ALARO</td><td style="text-align: right">ALARO MUSC with old_surface</td><td style="text-align: right"></td></tr></table><h2 id="Testbed-domains-1"><a class="docs-heading-anchor" href="#Testbed-domains-1">Testbed domains</a><a class="docs-heading-anchor-permalink" href="#Testbed-domains-1" title="Permalink"></a></h2><h2 id="The-playfile-1"><a class="docs-heading-anchor" href="#The-playfile-1">The playfile</a><a class="docs-heading-anchor-permalink" href="#The-playfile-1" title="Permalink"></a></h2><p>The playfile used for the testbed is  <a href="https://hirlam.org/trac/browser/Harmonie/msms/testbed.tdf">testbed.tdf</a>. Here each configuration is defined with a trigger, a task to create and one to follow the child experiments.  Configurations inluded are listed in the TESTBED<em>LIST environment variable in ecf/config</em>exp.h </p><pre><code class="language-bash"> TESTBED_LIST=&quot;ALADIN ALADIN_3DVAR AROME&quot;</code></pre><p>If the child experiment fails the Follow<em>exp task will also fail. When the child experiment problem has been corrected and the task restarted, the follow task should be restarted. When, finally, the child experiment is finished the test family will be completed and next test case will be triggered. We may choose to let the testbed launch a new experiment if the current child experiment fails. This is done by setting in ecf/config</em>exp.h  </p><pre><code class="language-bash"> TESTBED_CONT_ON_FAILURE=1</code></pre><h2 id="Input-data-1"><a class="docs-heading-anchor" href="#Input-data-1">Input data</a><a class="docs-heading-anchor-permalink" href="#Input-data-1" title="Permalink"></a></h2><p>The standard testbed configuration is run over several. The domain and resolution is chosen to be computationally cheap and not to give meteorologically interesting and meaningful results. Input data for running the testbed is ECMWF boundaries, observations, background error statistics and climate files. The latest data may be found  on cca:/scratch/ms/spsehlam/hlam/hm<em>home/some</em>recent<em>testbed</em>experiment/testbed_data and the data included is the following:</p><ul><li>ECMWF boundaries for the tested periods</li><li>Observations</li><li>Background errors</li><li>Climate files</li><li>Forcing data for nested experiments</li></ul><p>Download the data to your machine and put it on the default location <code>$HM_REV/testbed_data</code> or define your location in <a href="https://hirlam.org/trac/browser/Harmonie/scr/Harmonie_testbed.pl">Harmonie_testbed.pl</a>. If you wish to test the climate generation you simple redefine the location of the climate files or remove the existing ones in the climate directory of the testbed. The testbed data typically includes the following:</p><h2 id="Starting-the-testbed-1"><a class="docs-heading-anchor" href="#Starting-the-testbed-1">Starting the testbed</a><a class="docs-heading-anchor-permalink" href="#Starting-the-testbed-1" title="Permalink"></a></h2><p>The testbed experiment is setup as any normal experiment with</p><pre><code class="language-bash">Harmonie setup -r REVISION -h HOST</code></pre><p>The testbed is launched by</p><pre><code class="language-bash">Harmonie testbed </code></pre><p>Before you start the testbed you should define your reference experiment. The reference experiment is picked automatically as an experiment with the same name but with lower revision number. The reference experiment can also be defined by the by setting REFEXP in ecf/config_exp.h  as the full path to another testbed experiment:</p><pre><code class="language-bash">
export REFEXP=/scratch/ms/spsehlam/hlam/hm_home/test_37h12
</code></pre><h2 id="Evaluation-of-the-result-1"><a class="docs-heading-anchor" href="#Evaluation-of-the-result-1">Evaluation of the result</a><a class="docs-heading-anchor-permalink" href="#Evaluation-of-the-result-1" title="Permalink"></a></h2><p>At the end of each testbed run the results are compared to a reference experiment using the script <a href="https://hirlam.org/trac/browser/Harmonie/scr/Testbed_copmp">Testbed_comp</a>[scource:scr/Testbed<em>comp Testbed</em>comp]. The script uses xtool to check the numerical difference for the following output:</p><ul><li>ECMWF input data</li><li>climate files</li><li>Interpolated boundary files</li><li>Output forecast files in FA format</li><li>Output forecast files in GRIB format</li><li>vfld/vobs files</li></ul><p>In addition the internal consistency is checked by comparing runs with </p><ul><li>1D vs 2D decomposition</li><li>EPS control vs a deterministic run</li><li>Run with and without IO-server</li></ul><p>The choice of internal consistency tests reflects the history of problems and inconsistencies encountered.</p><pre><code class="language-bash">
HARMONIE testbed results from ecgb-vecf
Sat Nov 16 20:41:27 GMT 2019

Configuration: cca.gnu

Compare experiment ecgb_cca_testbed_develop_gnu_6147 and ecgb_cca_testbed_develop_gnu_6146

Check:ecmwf_bd
  Output grib file summary (differ/missing/total) 0/0/37
   comparison took 164 seconds
 Configuration ecmwf_bd is equal

Check:climate
  Output internal file summary (differ/missing/total) 0/0/52
   comparison took 34 seconds
 Configuration climate is equal

Check:AROME_3DVAR
  Output internal file summary (differ/missing/total) 0/0/36
   comparison took 79 seconds
  Output grib file summary (differ/missing/total) 0/0/96
   comparison took 91 seconds
  vfld/vobs file summary (differ/missing/total) 0/0/36
   comparison took 4 seconds
 Configuration AROME_3DVAR is equal

 ...

Compare AROME_BD_ARO and AROME_BD_ARO_IO_SERV
 No differences found
   comparison took 423 seconds

Testbed comparison complete

[ Status: OK]

 For more details please check /scratch/ms/spsehlam/hlam/hm_home/ecgb_cca_testbed_develop_gnu_6147/testbed_comp_6147.log_details
</code></pre><p>All the logs from any testbed experiment are posted to the testbed mailing list [https://hirlam.org/pipermail/testbed]. The test returns three different status signals</p><ul><li>OK means that all configurations reproduces the result of your reference experiment.</li><li>OK, BUT NO COMPARISON means that the suit run through but that there was nothing to compare with</li><li>FAILED means that the internal comparisons failed</li><li>DIFFER means that one more configurations differ from your reference experiment</li><li>FAILED and DIFFER is a combination of the last two</li></ul><p>In addition to the summary information detailed information can be found in the archive about the art of the difference.</p><h2 id="When-to-use-the-testbed-1"><a class="docs-heading-anchor" href="#When-to-use-the-testbed-1">When to use the testbed</a><a class="docs-heading-anchor-permalink" href="#When-to-use-the-testbed-1" title="Permalink"></a></h2><p>It is recommended to use the testbed when adding new options or make other changes in the configurations. If your new option is not activated the result compared with the reference experiment should be the same, if not you have to start debugging. When changing things for one configuration it&#39;s easy to break other ones. In such cases the testbed is a very good tool make sure you haven&#39;t destroyed anything.</p><hr/><p>Last modified </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../scripts/mSMS/">« mSMS</a><a class="docs-footer-nextpage" href="../Mitraillette/">Mitraillette »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 30 March 2021 17:19">Tuesday 30 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
