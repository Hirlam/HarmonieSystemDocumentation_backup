<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mitraillette · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../HarmonieTestbed/">Testbed</a></li><li class="is-active"><a class="tocitem" href>Mitraillette</a><ul class="internal"><li><a class="tocitem" href="#Configure-the-system-for-your-host.-1"><span>Configure the system for your host.</span></a></li><li><a class="tocitem" href="#c2a-instructions-based-on-cy40-1"><span>c2a instructions based on cy40</span></a></li><li><a class="tocitem" href="#Quick-start-on-c1a-1"><span>Quick start on c1a</span></a></li></ul></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Testbed and Mitraillette</a></li><li class="is-active"><a href>Mitraillette</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mitraillette</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/Evaluation/Mitraillette?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mitraillette-the-ALADIN-dynamical-core-testbed-1"><a class="docs-heading-anchor" href="#Mitraillette-the-ALADIN-dynamical-core-testbed-1">Mitraillette - the ALADIN dynamical core testbed</a><a class="docs-heading-anchor-permalink" href="#Mitraillette-the-ALADIN-dynamical-core-testbed-1" title="Permalink"></a></h1><p>Mitraillette is a script designed to validate ALADIN configurations and is particularly useful to test a new cycle. This script uses a chain of jobs: when a job is finished it launches the following job, in a predetermined order. There are several documents describing the system on the  <a href="http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&amp;recherche=mitraillette">gmapdoc site</a></p><p>The latest version of mitraillette can be found on:</p><pre><code class="language-bash">https://svn.hirlam.org/trunk/contrib/mitraille</code></pre><p>or</p><pre><code class="language-bash">beaufix:/home/gmap/mrpm/yessadk/SAVE/mitraille</code></pre><p>Due to current access limitations to tori, this version will not necessarily be up to date. It is, however, possible to check out the svn version from lxgmap workstations:</p><pre><code class="language-bash">svn co https://svn.hirlam.org/trunk/contrib/mitraille</code></pre><p>Before your start using mitraillette please read the general instructions in <a href="http://www.cnrm.meteo.fr/gmapdoc/meshtml/mitraillette.html">here</a></p><h2 id="Configure-the-system-for-your-host.-1"><a class="docs-heading-anchor" href="#Configure-the-system-for-your-host.-1">Configure the system for your host.</a><a class="docs-heading-anchor-permalink" href="#Configure-the-system-for-your-host.-1" title="Permalink"></a></h2><p>Under protojobs you find subdirectories for different hosts. Currently there are definitions for yuki and c1a. In each host directory there are four files.</p><pre><code class="language-bash">config           # Configuration of main directories and local environment variables
jobtrailer       # End of job specification
memtable         # Definition of memory requirements for different configurations
monoheader       # Header for a 1 PE job on the local batch system
multiheader      # Header for a N PE job on the local batch system
timetable        # Definition of wall time requirements for different configurations</code></pre><p>The main change is that the headers and trailers in the job*-files are separated. And that mitraillette.x has been updated to build the chain-files using these files. The config file is source in the beginning of the main script mitraillette.x.</p><p>The tori config file looks like</p><pre><code class="language-bash">
#
# Mitraillette configuration file for tori
#

# Where to find prototype jobs and namelists
REFDIR=/cnrm/gp/mrpm/mrpm624/mitraille

# where the prototype job_* files are
REF_JOBSDIR=$REFDIR/protojobs
# where the namelists are
REF_NAMDIR=$REFDIR/namelist


# Where to store the output files
WORKDIR=/work/$USER

# Where to put your modified job* files, i.e. the chain-files
# MITRA_HOME is defined in mitraiellette.x as your pwd
JOB_LOC=$MITRA_HOME
TMP_LOC=$TMP_LOC

# Location of input data
FILE_PATH=/cnrm/gp/mrpm/mrpm603/anal_a_mitraille

# Definition of cp/ecp for files and namelists
CP=&quot;/bin/cp -b 32768&quot;
ECP=&quot;/bin/cp -b 32768&quot;

# Batch and MPI launch definitions
SUBMIT=/usr/bin/nqsII/qsub
MPILAUNCH=&quot;mpirun -nn 1 -nnp nb_proc&quot;
LOPT_SCALAR=F
MBX_SIZE=0

# NEC specific envifonment variables
export F_UFMTENDIAN=31
export F_SYSLEN=1000
export F_FMTBUF=131072
export F_PROGINF=DETAIL
export F_FTRACE=FMT2
export F_RECLUNIT=BYTE
export MPIPROGINF=ALL_DETAIL
export MPISEPSELECT=0
export MPISUSPEND=ON
export MPIEXPORT=&quot;MPISUSPEND,F_FTRACE,F_FMTBUF,F_RECLUNIT,MPIPROGINF,PATH,DR_HOOK,DR_HOOK_IGNORE_SIGNALS&quot;
</code></pre><p>Modify to fit your needs or add your own host with the current definitions as a template.</p><p><strong>NPROMA</strong></p><p>None of the NPROMA settings are changed in the namelists. The current values are suitable for tori (NEC vector) but probably not for other machines. There is a small script, mitraille/util/Parse_nproma.pl, that changes all different values to one in the namelists.</p><h2 id="c2a-instructions-based-on-cy40-1"><a class="docs-heading-anchor" href="#c2a-instructions-based-on-cy40-1">c2a instructions based on cy40</a><a class="docs-heading-anchor-permalink" href="#c2a-instructions-based-on-cy40-1" title="Permalink"></a></h2><p>The following instructions will instruct the user on how to build the code to be evaluated by mitraillette using the Harmonie build system and how to use mitraillette.</p><h3 id="Build-executables-1"><a class="docs-heading-anchor" href="#Build-executables-1">Build executables</a><a class="docs-heading-anchor-permalink" href="#Build-executables-1" title="Permalink"></a></h3><p>On ecgb get the phasing code</p><pre><code class="language-bash">cd
mkdir -p harmonie_release/branches/phasing
cd harmonie_release/branches/phasing
svn co https://svn.hirlam.org/branches/phasing/cy40</code></pre><p>On ecgb build cy40</p><pre><code class="language-bash">cd
cd hm_home
mkdir cy40_main_makeup_c2a
cd cy40_main_makeup_c2a
~hlam/Harmonie setup -r $HOME/harmonie_release/branches/phasing/cy40
vi Env_system # set PRECOMPILED= to empty in Env_system - this ensures you will compile a nice fresh clean build
~hlam/Harmonie install</code></pre><h3 id="Run-mitraillette-1"><a class="docs-heading-anchor" href="#Run-mitraillette-1">Run mitraillette</a><a class="docs-heading-anchor-permalink" href="#Run-mitraillette-1" title="Permalink"></a></h3><p>On ecgb get mitraillette code and copy to c2a:</p><pre><code class="language-bash">cd
mkdir mitraille_releases
cd mitraille_releases
svn co https://svn.hirlam.org/trunk/contrib/mitraille
rsync -tvaz --exclude=.svn mitraille /cca/perm/ms/ie/dui # please insert correct PATH to your PERM directory</code></pre><p>The next few instructions are a bit messy - I am waiting for access to MF mitraille before I update trunk/contrib/mitraille properly. In the meantime ...Make a copy of the Harmonie executables in PERM on c2a:</p><pre><code class="language-bash">mkdir -p $PERM/HarmBin/cy40ald/
cp $TEMP/hm_home/cy40_main_makeup_c2a/bin/MASTERODB $PERM/HarmBin/cy40ald/
cp $TEMP/hm_home/cy40_main_makeup_c2a/bin/PGD $PERM/HarmBin/cy40ald/</code></pre><p>Log in to c2a and configure and run your mitraillette evaluation as follows:</p><pre><code class="language-bash">cd $PERM/mitraille
./mitraillette_v012014.x AL40T1 PRO_FILE.al40t1_hirlam_mono mono
./test.xNNNN</code></pre><p>This PRO_FILE points to  /perm/ms/ie/dui/HarmBin/cy40ald/MASTERODB copied above. The mitraillette.x script will have created a test script called test.xNNNN where NNNN is an integer. Let&#39;s run the test script:</p><pre><code class="language-bash">./test.xNNNN</code></pre><p>Now have a look at the output produced. Still on c2a:</p><pre><code class="language-bash">cd $TEMP/mitraillette/al40t1/mitraillette_NNNN
ls -ltr
cd $TEMP/OUTPUT_FILES/AL40T1
ls -ltr</code></pre><h3 id="MORE-TO-FOLLOW-1"><a class="docs-heading-anchor" href="#MORE-TO-FOLLOW-1">MORE TO FOLLOW</a><a class="docs-heading-anchor-permalink" href="#MORE-TO-FOLLOW-1" title="Permalink"></a></h3><p><strong>Please note: I have yet to merge the cycle 40 mitraillette updates into trunk/contrib. I want to get these updates from MF myself</strong> I have to see if my tests have succeeded! </p><h2 id="Quick-start-on-c1a-1"><a class="docs-heading-anchor" href="#Quick-start-on-c1a-1">Quick start on c1a</a><a class="docs-heading-anchor-permalink" href="#Quick-start-on-c1a-1" title="Permalink"></a></h2><ul><li>Check out the script and put i under HOME/mitraille on c1a. </li><li>Modify PRO_FILE.al37.c1a to point to your binary</li><li>Create directory al37</li><li>Create a multi job chain by</li></ul><pre><code class="language-bash">./mitraillette.x AL37 PRO_FILE.al37.c1a multi </code></pre><ul><li>Run the created test.xNNNN script</li><li>Results can be found under TEMP</li></ul><p><strong>Utilities</strong></p><p>A set of exmple scripts used to compare different runs are gathered under util. Read more in the util/README. Please fill with your own tools!</p><hr/><p>Last modified [[LastModified]]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../HarmonieTestbed/">« Testbed</a><a class="docs-footer-nextpage" href="../../Content/">Directories »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 6 September 2021 15:27">Monday 6 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
