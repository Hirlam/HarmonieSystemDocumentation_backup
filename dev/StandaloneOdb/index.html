<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stand Alone ODB · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../Installation/">Installation</a></li><li><a class="tocitem" href="../General/">General Software Requirements</a></li><li><a class="tocitem" href="../Build_with_makeup/">Makeup</a></li><li class="is-active"><a class="tocitem" href>Stand Alone ODB</a><ul class="internal"><li><a class="tocitem" href="#Get-the-software-1"><span>Get the software</span></a></li><li><a class="tocitem" href="#Building-your-ODB-software-1"><span>Building your ODB software</span></a></li><li class="toplevel"><a class="tocitem" href="#ACTION:-FOR-EOIN:-everything-below-here-needs-to-be-updated-1"><span>ACTION: FOR EOIN: everything below here needs to be updated</span></a></li><li class="toplevel"><a class="tocitem" href="#ODB-data-1"><span>ODB data</span></a></li><li><a class="tocitem" href="#Convert-ODB-1-to-ODB-2-1"><span>Convert ODB-1 to ODB-2</span></a></li><li><a class="tocitem" href="#Instructions-for-use-on-ecgb-1"><span>Instructions for use on ecgb</span></a></li><li class="toplevel"><a class="tocitem" href="#ODB-visualisation-1"><span>ODB visualisation</span></a></li></ul></li><li><a class="tocitem" href="../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../Content/">Directories</a></li><li><a class="tocitem" href="../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../Namelists/">Namelist</a></li><li><a class="tocitem" href="../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox"/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ObservationPreprocessing/ObservationData/">Observation data</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../ObservationPreprocessing/Bator/">Bator</a></li><li><a class="tocitem" href="../ObservationPreprocessing/Oulan/">Oulan</a></li><li><a class="tocitem" href="../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../Screening/">Screening</a></li><li><a class="tocitem" href="../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Installation</a></li><li class="is-active"><a href>Stand Alone ODB</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stand Alone ODB</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/StandaloneOdb?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ODB-software-1"><a class="docs-heading-anchor" href="#ODB-software-1">ODB software</a><a class="docs-heading-anchor-permalink" href="#ODB-software-1" title="Permalink"></a></h1><h2 id="Get-the-software-1"><a class="docs-heading-anchor" href="#Get-the-software-1">Get the software</a><a class="docs-heading-anchor-permalink" href="#Get-the-software-1" title="Permalink"></a></h2><p>To make best use of ODB information produced by your Harmonie experiment one should use ODB and ODB-API software developed by ECMWF. Below are instruction on how to obtain the software from ECMWF.</p><h3 id="ODB-API-1"><a class="docs-heading-anchor" href="#ODB-API-1">ODB-API</a><a class="docs-heading-anchor-permalink" href="#ODB-API-1" title="Permalink"></a></h3><p>ODB-API software is open source and released under an Apache licence: <a href="https://software.ecmwf.int/wiki/display/ODBAPI">https://software.ecmwf.int/wiki/display/ODBAPI</a> </p><h3 id="ODB-1"><a class="docs-heading-anchor" href="#ODB-1">ODB</a><a class="docs-heading-anchor-permalink" href="#ODB-1" title="Permalink"></a></h3><p><em>ODB stands for Observational !DataBase. It is database software to store and retrieve large amounts of meteorological numerical data in an efficient manner while used from within IFS. ODB software mimics relational database queries through its ODB/SQL -compiler and accesses data currently via a Fortran90 library interface.</em> The original documentation is available here: <a href="http://www.ecmwf.int/research/ifsdocs/CY28r1/pdf_files/odb.pdf">http://www.ecmwf.int/research/ifsdocs/CY28r1/pdf_files/odb.pdf</a></p><h2 id="Building-your-ODB-software-1"><a class="docs-heading-anchor" href="#Building-your-ODB-software-1">Building your ODB software</a><a class="docs-heading-anchor-permalink" href="#Building-your-ODB-software-1" title="Permalink"></a></h2><p>The ODB-API Software bundle uses cmake <a href="http://www.cmake.org">http://www.cmake.org</a> to configure the make files used to compile the software. The instructions below worked with Redhat 7/GCC 4.8.5 and CentOS 7/GCC 4.8.5. On newer systems python functionality may have to be switched off with -DENABLE_PYTHON=OFF.</p><pre><code class="language-bash">VERSION=0.18.1
wget https://software.ecmwf.int/wiki/download/attachments/61117379/odb_api_bundle-${VERSION}-Source.tar.gz
gunzip odb_api_bundle-${VERSION}-Source.tar.gz
tar -xvf odb_api_bundle-${VERSION}-Source.tar
cd odb_api_bundle-${VERSION}-Source
mkdir build
cd build
cmake.. -DCMAKE_INSTALL_PREFIX=/opt/metapp/odb_api/${VERSION}/gnu \
-DENABLE_ODB_API_SERVER_SIDE=ON -DENABLE_FORTRAN=ON \
-DENABLE_GRIB=OFF -DENABLE_ODB_SERVER_TIME_FORMAT_FOUR_DIGITS=ON \
-DENABLE_PYTHON=ON -DENABLE_ODB=ON -DODB_SCHEMAS=&quot;ECMA;CCMA&quot;
make -j 2
ctest
make install</code></pre><h1 id="ACTION:-FOR-EOIN:-everything-below-here-needs-to-be-updated-1"><a class="docs-heading-anchor" href="#ACTION:-FOR-EOIN:-everything-below-here-needs-to-be-updated-1">ACTION: FOR EOIN: everything below here needs to be updated</a><a class="docs-heading-anchor-permalink" href="#ACTION:-FOR-EOIN:-everything-below-here-needs-to-be-updated-1" title="Permalink"></a></h1><h1 id="ODB-data-1"><a class="docs-heading-anchor" href="#ODB-data-1">ODB data</a><a class="docs-heading-anchor-permalink" href="#ODB-data-1" title="Permalink"></a></h1><h2 id="Convert-ODB-1-to-ODB-2-1"><a class="docs-heading-anchor" href="#Convert-ODB-1-to-ODB-2-1">Convert ODB-1 to ODB-2</a><a class="docs-heading-anchor-permalink" href="#Convert-ODB-1-to-ODB-2-1" title="Permalink"></a></h2><p>Details on how to convert your ODB-1 (Harmonie experiment) databases to ODB-2 using odb_migrator are described here. I have used version 0.9.31 of ODB-API (I have had some problems with 0.9.32). I will use a Harmonie CCMA conventional ODB-1 database as an example:</p><pre><code class="language-bash">tar -xvf odb_ccma.tar
cd odb_ccma/CCMA/
dcagen
cd ../../
ls -l ../conv.38h1.sql
which odb_migrator
/opt/metlib/odb_api/0.9.31/gnu/bin/odb_migrator -addcolumns &quot;expver=&#39;    38h1&#39;,class=2,stream=1025,type=264&quot; odb_ccma/CCMA ../conv.38h1.sql var${DTG}.odb
ls -l var${DTG}.odb</code></pre><p>Here is the SQL file used: <a href="https://hirlam.org/trac/attachment/wiki/HarmonieSystemDocumentation/StandaloneOdb/conv.38h1.sql">conv.38h1.sql</a>. To construct my conv.38h1.sql file did carried out the following commands:</p><pre><code class="language-bash">cd odb_ccma/CCMA/
odbsql -q &quot;select * from desc,timeslot_index,hdr,body&quot; | head -1 </code></pre><h2 id="Instructions-for-use-on-ecgb-1"><a class="docs-heading-anchor" href="#Instructions-for-use-on-ecgb-1">Instructions for use on ecgb</a><a class="docs-heading-anchor-permalink" href="#Instructions-for-use-on-ecgb-1" title="Permalink"></a></h2><p>On ecgb I have installed <em>odb_migrator</em> in my own account. ODB developers have promise to provide a &quot;system&quot; installation of odb<em>migrator soon. The next version of ODB-API on ecgb should include *odb</em>migrator*. My installation is here:</p><pre><code class="language-bash">/home/ms/ie/dui/odbapi/0.9.31</code></pre><p>To produce your own ODB-2 file from a Harmonie CCMA tar ball on ecgb:</p><pre><code class="language-bash">module load odb
export PATH=/home/ms/ie/dui/odbapi/0.9.31/bin:$PATH
export LD_LIBRARY_PATH=/home/ms/ie/dui/odbapi/0.9.31/lib:$LD_LIBRARY_PATH
cd $SCRATCH
mkdir ODB2odb
cd ODB2odb
## copy your odb_stuff.tar/odb_ccma.tar file from ECFS/your home system to this directory
## eg -- ecp ec:/dui/harmonie/refSonde38h1p1/2013/12/27/00/odb_stuff.tar .
tar -xvf odb_stuff.tar
tar -xvf odb_ccma.tar
cd odb_ccma/CCMA/
dcagen
cd ../../
odb_migrator odb_ccma/CCMA -addcolumns &quot;expver=&#39;refSonde&#39;,class=2,stream=1025,type=264&quot; /home/ms/ie/dui/odbapi/conv.38h1.sql conv2013122700.odb
odb header conv2013122700.odb
odb sql &#39;select distinct varno&#39; -i conv2013122700.odb
odb sql &#39;select count(*) where varno=2&#39; -i conv2013122700.odb
#
rm -f bdstrategy odb*.tar ## tidy up the directory if you wish
rm -rf odb_ccma</code></pre><h1 id="ODB-visualisation-1"><a class="docs-heading-anchor" href="#ODB-visualisation-1">ODB visualisation</a><a class="docs-heading-anchor-permalink" href="#ODB-visualisation-1" title="Permalink"></a></h1><p>ODB-2 data can be visualized (directly) using Metview. On local platforms Metview must be built with ODB support (that uses ODB-API software) to visualize ODB-2 data. Here is an example, odbmap.mv4, of using Metview on ecagte to visualize ODB-2 data using a Metview Macro. This example requires an ODB-2 data file as input. Optionally this macro can also plot domain grid-points from a Harmonie GRIB file (called dom.grib) to indicate the extent of your Harmonie model domain.</p><ul><li>Usage:</li></ul><pre><code class="language-bash"> odbmap:: Usage: metview -b odbmap.mv4 inputfile odbvar odbrequest odblegend outputtype
 odbmap::   where: inputfile  -- ODB-2 file
 odbmap::   where: odbvar     -- ODB variable to be plotted
 odbmap::                     -- (enclosed with inverted commas)
 odbmap::   where: odbrequest -- ODB SQL request 
 odbmap::                     -- (enclosed with inverted commas)
 odbmap::   where: odblegend  -- legon/legoff
 odbmap::   where: outputtype -- ps/png</code></pre><ul><li>An example to plot 2m temperature observation values on 25th December 2013 at 12z:</li></ul><pre><code class="language-bash">cd  $SCRATCH
cp -r /home/ms/ie/dui/odbMacroTest .
cd odbMacroTest
metview4 -b odbmap.mv4 conv201312.odb &quot;obsvalue&quot; &quot;andate=20131225 and antime=120000 and varno=39&quot; legon png
xv odbmap.1.png</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Build_with_makeup/">« Makeup</a><a class="docs-footer-nextpage" href="../Redhat7Install/">Redhat7 »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 6 September 2021 15:27">Monday 6 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
