<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Oulan · Harmonie wiki</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit">Harmonie wiki</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Running at ECMWF and local</span><ul><li><a class="tocitem" href="../../Harmonie-mSMS/">Running at ECMWF</a></li><li><a class="tocitem" href="../../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../QuickStartLocal/">Quick start local</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../Installation/">Installation</a></li><li><a class="tocitem" href="../../General/">General Software Requirements</a></li><li><a class="tocitem" href="../../Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand Alone ODB</a></li><li><a class="tocitem" href="../../Redhat7Install/">Redhat7</a></li><li><a class="tocitem" href="../../Centos6Install/">Centos6</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie Script</a></li><li><a class="tocitem" href="../../DrHook/">Profiling and Traceback</a></li><li><a class="tocitem" href="../../FileFormats/">File Formats</a></li><li><span class="tocitem">Job Scheduling</span><ul><li><a class="tocitem" href="../../ECFLOW/">ECFlow</a></li><li><a class="tocitem" href="../../scripts/mXCdp/">mXCdp</a></li><li><a class="tocitem" href="../../scripts/mSMS/">mSMS</a></li></ul></li><li><span class="tocitem">Testbed and Mitraillette</span><ul><li><a class="tocitem" href="../../Evaluation/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../Evaluation/Mitraillette/">Mitraillette</a></li></ul></li><li><span class="tocitem">Directories  and Binaries</span><ul><li><a class="tocitem" href="../../Content/">Directories</a></li><li><a class="tocitem" href="../../Binaries/">Binaries</a></li></ul></li><li><span class="tocitem">Configuration</span><ul><li><a class="tocitem" href="../../ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../Namelists/">Namelist</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../ModelDomain/">Model Domain</a></li><li><a class="tocitem" href="../../VerticalGrid/">Vertical Grid</a></li><li><a class="tocitem" href="../../ClimateSimulation/">Climate Simulation</a></li><li><a class="tocitem" href="../../How_to_use_hires_topography/">Hires topography</a></li></ul></li><li><span class="tocitem">ECFlow tasks</span><ul><li><a class="tocitem" href="../../ClimateGeneration/">Climate</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox" checked/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../UseofObservation/">Use of Observation</a></li><li><a class="tocitem" href="../../ObservationOperators/">Observation operators</a></li><li><a class="tocitem" href="../../ObservationHowto/GNSS/">GNSS ZTD observations</a></li><li><a class="tocitem" href="../../ObservationHowto/Amv/">Atmospheric Motion Vectors (AMV)</a></li><li><a class="tocitem" href="../../RadarData/">Assimilation of Radar Data</a></li><li><input class="collapse-toggle" id="menuitem-11-2-6" type="checkbox" checked/><label class="tocitem" for="menuitem-11-2-6"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ObservationData/">Observation data</a></li><li><a class="tocitem" href="../Bator/">Bator</a></li><li class="is-active"><a class="tocitem" href>Oulan</a><ul class="internal"><li><a class="tocitem" href="#General-Description-1"><span>General Description</span></a></li><li><a class="tocitem" href="#!ShuffleBufr-1"><span>!ShuffleBufr</span></a></li><li><a class="tocitem" href="#oulan-1"><span>oulan</span></a></li></ul></li><li><a class="tocitem" href="../Cope/">Cope</a></li></ul></li></ul></li><li><a class="tocitem" href="../Bator/">Bator</a></li><li><a class="tocitem" href>Oulan</a></li><li><a class="tocitem" href="../../BoundaryFilePreparation/">Boundaries</a></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../Analysis/SurfaceAnalysis/">Surface Analysis</a></li><li><a class="tocitem" href="../../DigitialFilterInitialization/">DFI</a></li><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><input class="collapse-toggle" id="menuitem-11-10" type="checkbox"/><label class="tocitem" for="menuitem-11-10"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Obsmon/">Obsmon</a></li><li><a class="tocitem" href="../../PostPP/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostPP/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostPP/gl/Interpolation/">GL interpolation</a></li><li><input class="collapse-toggle" id="menuitem-11-10-5" type="checkbox"/><label class="tocitem" for="menuitem-11-10-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostPP/Verification/">HARMONIE Verification</a></li><li><a class="tocitem" href="../../PostPP/Extract4verification/">-</a></li></ul></li><li><a class="tocitem" href="../../PostPP/Fullpos/">Fullpos</a></li><li><a class="tocitem" href="../../PostPP/FileConversions/">FileConversion</a></li><li><a class="tocitem" href="../../PostPP/gl_grib_api/">gl<em>grib</em>api</a></li></ul></li></ul></li><li><span class="tocitem">Other</span><ul><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Harmonie RAPS benchmark</a></li><li><a class="tocitem" href="../../MFaccess/">Using Météo-France Servers</a></li><li><a class="tocitem" href="../../Phasing/">Phasing information</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ECFlow tasks</a></li><li><a class="is-disabled">Observations</a></li><li><a class="is-disabled">Preprocessing</a></li><li class="is-active"><a href>Oulan</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Oulan</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://hirlam.org/trac//wiki//HarmonieSystemDocumentation/ObservationPreprocessing/Oulan?action=edit" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="OBSOUL-creation:-Oulan-1"><a class="docs-heading-anchor" href="#OBSOUL-creation:-Oulan-1">OBSOUL creation: Oulan</a><a class="docs-heading-anchor-permalink" href="#OBSOUL-creation:-Oulan-1" title="Permalink"></a></h1><h2 id="General-Description-1"><a class="docs-heading-anchor" href="#General-Description-1">General Description</a><a class="docs-heading-anchor-permalink" href="#General-Description-1" title="Permalink"></a></h2><p>The pre-processing step creates ODB (Observational Data Base) from various observation data files possibly in different formats.</p><ul><li>Software: The programs used for pre-processing (Shufflebufr, oulan and BATOR) are not part of the IFS code. oulan is software developed at Météo France to extract observations from their local database (BDM). The output of oulan (OBSOUL) is one of the inputs of BATOR. BATOR is also software developed at Météo France to generate the ODB (Observational !DataBase) database for the ARPEGE/ALADIN/HARMONIE analysis system. ODB is a tailor made database software developed at ECMWF to manage very large observational data volumes assimilated in the IFS 4DVAR system, and to enable flexible post-processing of this data <a href="http://old.ecmwf.int/services/odb/odb_overview.pdf">(Sami Saarinen, 2006)</a>. We use oulan to generate an OBSOUL file from different BUFR files (note you can easily change the oulan program to handle data in different format than BUFR. For example in OPLACE data processing some files are in netCDF format). OBSOUL file is an ASCII formatted file, the content of which is similar to that of the CMA (Central Memory Array, packing format actually in use in the HIRLAM data assimilation system). Our version of ouland is placed under “util” directory in the repository. HARMONIE BATOR originates from the MF export-pack. The figure bellow describes the mechanism of the observation pre-processing in HARMONIE DA. To sum it up, !ShuffleBufr splits different observations into BUFR files, then oulan creates the OBSOUL file, and BATOR creates the ODB file using satellite BUFR/GRIB/BIN files and the OBSOUL one.</li><li>Compilation: oulan, Shufflebufr are compiled using gmakpack or makeup.</li><li>Scripts: Oulan</li><li>Input/output<ul><li>oulan  input: BUFR files; output: the OBSOUL file in ASCII format</li></ul></li></ul><h2 id="!ShuffleBufr-1"><a class="docs-heading-anchor" href="#!ShuffleBufr-1">!ShuffleBufr</a><a class="docs-heading-anchor-permalink" href="#!ShuffleBufr-1" title="Permalink"></a></h2><p>!ShuffleBufr splits different observations into separate BUFR files according the IFS observation type/sub-type definition. Some of them (essentially those of conventional observations) are then fed to OULAN; the others go directly into BATOR.</p><pre><code class="language-bash">    PROGRAM SHUFFLEBUFR
    Split and shuffle BUFR file into  specific BUFR files for OULAN
  
    Usage: SHUFFLEBUFR -i &lt;bufr_file&gt; [-s1|-s2|-s3]  [-a] [-r]
  
           -s1 : Synop ship will be extracted in &lt;synop&gt;
           -s2 : Synop ship will be extracted in &lt;buoy&gt;
           -s3 : Synop ship will be extracted in &lt;ship&gt;
  
           Nota Bene: If -s1,-s2 or -s3 are not specified
                      synop_ship will not be extracted
  
           -a  : Extracts ATOVS in files amsua and amsub
  
           -r  : Extracts also record messages (synop)</code></pre><p>The splitting is done with the following command (BUFRFILE is a file containing all observations) in the Oulan script:</p><pre><code class="language-bash">      $BINDIR/ShuffleBufr -i ${BUFRFILE} -s3 -a </code></pre><h2 id="oulan-1"><a class="docs-heading-anchor" href="#oulan-1">oulan</a><a class="docs-heading-anchor-permalink" href="#oulan-1" title="Permalink"></a></h2><p>oulan reads (primarily conventional observation) BUFR data and converts them into ASCII format OBSOUL files. Note, <strong>we can make observation selection</strong> in oulan. More details about how to do data selection can be found <a href="http://owww.met.hu/pages/seminars/ALADIN2005/28_Bp_workshop1n_n_RogerR.ppt">here (Randriamampianina, ALADIN/HIRLAM Workshop 2005)</a></p><ol><li>namelist description: </li></ol><table><tr><th style="text-align: right"><strong>NADIRS</strong></th><th style="text-align: right"></th></tr><tr><td style="text-align: right">ALANZA=90.,</td><td style="text-align: right">If LZONEA is true then only extract observations south of 90N</td></tr><tr><td style="text-align: right">ALASZA=0.,</td><td style="text-align: right">If LZONEA is true then only extract observations north of 0</td></tr><tr><td style="text-align: right">ALOEZA=-180.,</td><td style="text-align: right">If LZONEA is true then only extract observations west of 180W</td></tr><tr><td style="text-align: right">ALOOZA=180.,</td><td style="text-align: right">If LZONEA is true then only extract observations west of 180E</td></tr><tr><td style="text-align: right">LNEWSYNOPBUFR=.FALSE.,</td><td style="text-align: right">Process new format BUFR SYNOP <strong>experimental</strong></td></tr><tr><td style="text-align: right">LNEWSHIPBUFR=.FALSE.,</td><td style="text-align: right">Process new format BUFR SHIP <strong>experimental</strong></td></tr><tr><td style="text-align: right">LNEWBUOYBUFR=.FALSE.,</td><td style="text-align: right">Process new format BUFR BUOY <strong>experimental</strong></td></tr><tr><td style="text-align: right">LNEWTEMPBUFR=.FALSE.,</td><td style="text-align: right">Process new format BUFR TEMP <strong>experimental</strong></td></tr><tr><td style="text-align: right">LACAR=.TRUE.,</td><td style="text-align: right">Process ACARS BUFR data</td></tr><tr><td style="text-align: right">LAIREP=.TRUE.,</td><td style="text-align: right">Process AIREP BUFR data</td></tr><tr><td style="text-align: right">LAMDAR=.TRUE.,</td><td style="text-align: right">Process AMDAR BUFR data</td></tr><tr><td style="text-align: right">LBUOY=.TRUE.,</td><td style="text-align: right">Process BUOY BUFR data</td></tr><tr><td style="text-align: right">LEUROPROFIL=.FALSE.,</td><td style="text-align: right">Process European Profiler BUFR data</td></tr><tr><td style="text-align: right">LPILOT=.TRUE.,</td><td style="text-align: right">Process PILOT BUFR data</td></tr><tr><td style="text-align: right">LRH2Q=.FALSE.,</td><td style="text-align: right">Extract 2m RH from SYNOP, BUOY and TEMP BUFR data</td></tr><tr><td style="text-align: right">LSHIP=.TRUE.,</td><td style="text-align: right">Process SHIP BUFR data</td></tr><tr><td style="text-align: right">LSYNOP=.TRUE.,</td><td style="text-align: right">Process SYNOP BUFR data</td></tr><tr><td style="text-align: right">LTEMP=.TRUE.,</td><td style="text-align: right">Process TEMP BUFR data</td></tr><tr><td style="text-align: right">LTEMPDROP=.TRUE.,</td><td style="text-align: right">Process DROPTEMP BUFR data</td></tr><tr><td style="text-align: right">LTEMPSHIP=.TRUE.,</td><td style="text-align: right">Process TEMPSHIP BUFR data</td></tr><tr><td style="text-align: right">LTOVSAMSUA=.FALSE.,</td><td style="text-align: right">Process AMSUA data</td></tr><tr><td style="text-align: right">LTOVSAMSUB=.FALSE.,</td><td style="text-align: right">Process AMSUB data</td></tr><tr><td style="text-align: right">LTOVSHIRS=.FALSE.,</td><td style="text-align: right">Process HIRS data</td></tr><tr><td style="text-align: right">LZONEA=.TRUE.,</td><td style="text-align: right">Switch to extract data in defined lat-lon domain (N,S,E,W)</td></tr><tr><td style="text-align: right">NDATE=DDATE,</td><td style="text-align: right">OBSOUL Date</td></tr><tr><td style="text-align: right">NDIFFM1=30,</td><td style="text-align: right">Define analysis window (T-NDIFFM1)</td></tr><tr><td style="text-align: right">NDIFFM2=300,</td><td style="text-align: right">Define analysis window (T-NDIFFM2)</td></tr><tr><td style="text-align: right">NDIFFP1=30,</td><td style="text-align: right">Define analysis window (T+NDIFFP1)</td></tr><tr><td style="text-align: right">NDIFFP2=259,</td><td style="text-align: right">Define analysis window (T+NDIFFP2)</td></tr><tr><td style="text-align: right">NINIT=0,</td><td style="text-align: right">flag used by oulan to prevent writing if problem is found</td></tr><tr><td style="text-align: right">NRESO=HHOUR,</td><td style="text-align: right">OBSOUL Hour</td></tr><tr><td style="text-align: right"><strong>NANBOB</strong></td><td style="text-align: right">Namelist to define number of observations to be extracted</td></tr><tr><td style="text-align: right">NBACAR=750000,</td><td style="text-align: right">Number of ACAR obs</td></tr><tr><td style="text-align: right">NBAIREP=750000,</td><td style="text-align: right">Number of AIREP obs</td></tr><tr><td style="text-align: right">NBAMDAR=750000,</td><td style="text-align: right">Number of AMDAR obs</td></tr><tr><td style="text-align: right">NBBUOY=  4000,</td><td style="text-align: right">Number of BUOY obs</td></tr><tr><td style="text-align: right">NBEUROPROFIL= 15000,</td><td style="text-align: right">Number of European profiler obs</td></tr><tr><td style="text-align: right">NBPILOT=  2000,</td><td style="text-align: right">Number of PILOT obs</td></tr><tr><td style="text-align: right">NBSHIP= 30000,</td><td style="text-align: right">Number of SHIP obs</td></tr><tr><td style="text-align: right">NBSYNOP= 60000,</td><td style="text-align: right">Number of SYNOP obs</td></tr><tr><td style="text-align: right">NBTEMP=  2000,</td><td style="text-align: right">Number of Land TEMP obs (since r14078)</td></tr><tr><td style="text-align: right">NBTEMPDROP=  1000,</td><td style="text-align: right">Number of DROPTEMP obs (since r14078)</td></tr><tr><td style="text-align: right">NBTEMPSHIP=  1000,</td><td style="text-align: right">Number of Ship TEMP obs (since r14078)</td></tr><tr><td style="text-align: right">NBTOVSAMSUA= 80000,</td><td style="text-align: right">Number of AMSUA obs</td></tr><tr><td style="text-align: right">NBTOVSAMSUB= 80000,</td><td style="text-align: right">Number of AMSUB obs</td></tr><tr><td style="text-align: right">NBTOVSHIRS=  8000,</td><td style="text-align: right">Number of HIRS obs</td></tr></table><ol><li>make a namelist</li></ol><pre><code class="language-bash">  NAMELIST=$WRK/$WDIR/namelist_oulan
  Get_namelist oulan $NAMELIST
  sed -e &quot;s/DDATE/$SDATE/&quot; \
      -e &quot;s/HHOUR/$SHOUR/&quot;
      -e &quot;s/SALOOZA/$OULWEST/&quot;  \
      -e &quot;s/SALANZA/$OULNORTH/&quot;  \
      -e &quot;s/SALOEZA/$OULEAST/&quot;  \
      -e &quot;s/SALASZA/$OULSOUTH/&quot; \
      -e &quot;s/SLNEWSYNOPBUFR/$SLNEWSYNOPBUFR/&quot; \
      -e &quot;s/SLNEWSHIPBUFR/$SLNEWSHIPBUFR/&quot; \
      -e &quot;s/SLNEWBUOYBUFR/$SLNEWBUOYBUFR/&quot; \
      -e &quot;s/SLNEWTEMPBUFR/$SLNEWTEMPBUFR/&quot; \
      ${NAMELIST} &gt;NAMELIST</code></pre><ol><li>run oulan</li></ol><pre><code class="language-bash">    $BINDIR/oulan </code></pre><ol><li>process GNSS data. If GNSS_OBS is set to 1 then GNSS observations are added to the OBSOUL file and whitelisting is carried out using PREGPSSOL</li></ol><h3 id="New-BUFR-templates-1"><a class="docs-heading-anchor" href="#New-BUFR-templates-1">New BUFR templates</a><a class="docs-heading-anchor-permalink" href="#New-BUFR-templates-1" title="Permalink"></a></h3><p><strong>Valid for HARMONIE 40h1 and later</strong></p><p>The use of new format (GTS WMO) BUFR is controlled in <a href="https://hirlam.org/trac/browser/Harmonie/scr/include.ass">scr/include.ass</a> by LNEWSYNOPBUFR, LNEWSHIPBUFR, LNEWBUOYBUFR, LNEWTEMPBUFR (set to 0 or 1). These environment variables control namelist settings in the Oulan script. GTS and ECMWF BUFR were used to guide the code changes so Oulan assumes either &quot;flavour&quot; of BUFR. Local changes may be required if your locally produced BUFR, in particular section 1 data sub-type settings, do not follow WMO and/or ECMWF practices.</p><p>The ECMWF wiki contains updates regarding the quality of the new BUFR HR observations. See the following ECMWF wiki pages for furher information:</p><ul><li><a href="https://software.ecmwf.int/wiki/display/TCBUF/TAC+To+BUFR+Migration">https://software.ecmwf.int/wiki/display/TCBUF/TAC+To+BUFR+Migration</a></li><li><a href="https://software.ecmwf.int/wiki/display/TCBUF/Statistics+of+High+resolution+BUFR+TEMP">https://software.ecmwf.int/wiki/display/TCBUF/Statistics+of+High+resolution+BUFR+TEMP</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Bator/">« Bator</a><a class="docs-footer-nextpage" href="../Cope/">Cope »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 30 March 2021 17:19">Tuesday 30 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
